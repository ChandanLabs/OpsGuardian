{"version":3,"file":"flows-endpoint.mjs","names":[],"sources":["../../../src/endpoints/flows-endpoint.ts"],"sourcesContent":["import { z } from 'zod'\nimport { generateFlow } from '../helper/flows-helper'\nimport type { LockedData } from '../locked-data'\nimport { FlowsStream } from '../streams/flows-stream'\n\nexport const flowsEndpoint = (lockedData: LockedData) => {\n  const flowsStream = lockedData.createStream(\n    {\n      filePath: '__motia.flows',\n      hidden: true,\n      config: {\n        name: '__motia.flows',\n        schema: z.object({ id: z.string(), name: z.string(), steps: z.any(), edges: z.any() }),\n        baseConfig: { storageType: 'custom', factory: () => new FlowsStream(lockedData) },\n      },\n    },\n    { disableTypeCreation: true },\n  )()\n\n  lockedData.on('flow-created', (flowId) => {\n    const flow = lockedData.flows[flowId]\n    const response = generateFlow(flowId, flow.steps)\n    flowsStream.set('default', flowId, response)\n  })\n\n  lockedData.on('flow-updated', (flowId) => {\n    const flow = lockedData.flows[flowId]\n    const response = generateFlow(flowId, flow.steps)\n    flowsStream.set('default', flowId, response)\n  })\n\n  lockedData.on('flow-removed', (flowId) => flowsStream.delete('default', flowId))\n}\n"],"mappings":";;;;;AAKA,MAAa,iBAAiB,eAA2B;CACvD,MAAM,cAAc,WAAW,aAC7B;EACE,UAAU;EACV,QAAQ;EACR,QAAQ;GACN,MAAM;GACN,QAAQ,EAAE,OAAO;IAAE,IAAI,EAAE,QAAQ;IAAE,MAAM,EAAE,QAAQ;IAAE,OAAO,EAAE,KAAK;IAAE,OAAO,EAAE,KAAK;IAAE,CAAC;GACtF,YAAY;IAAE,aAAa;IAAU,eAAe,IAAI,YAAY,WAAW;IAAE;GAClF;EACF,EACD,EAAE,qBAAqB,MAAM,CAC9B,EAAE;AAEH,YAAW,GAAG,iBAAiB,WAAW;EACxC,MAAM,OAAO,WAAW,MAAM;EAC9B,MAAM,WAAW,aAAa,QAAQ,KAAK,MAAM;AACjD,cAAY,IAAI,WAAW,QAAQ,SAAS;GAC5C;AAEF,YAAW,GAAG,iBAAiB,WAAW;EACxC,MAAM,OAAO,WAAW,MAAM;EAC9B,MAAM,WAAW,aAAa,QAAQ,KAAK,MAAM;AACjD,cAAY,IAAI,WAAW,QAAQ,SAAS;GAC5C;AAEF,YAAW,GAAG,iBAAiB,WAAW,YAAY,OAAO,WAAW,OAAO,CAAC"}