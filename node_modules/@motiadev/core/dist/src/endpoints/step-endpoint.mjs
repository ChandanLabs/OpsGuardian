import { generateStepId } from "../helper/flows-helper.mjs";
import path from "node:path";
import fs from "fs/promises";

//#region src/endpoints/step-endpoint.ts
const getFeatures = async (filePath) => {
	const stat = await fs.stat(`${filePath}-features.json`).catch(() => null);
	if (!stat || stat.isDirectory()) return [];
	try {
		const content = await fs.readFile(`${filePath}-features.json`, "utf8");
		return JSON.parse(content);
	} catch {
		return [];
	}
};
const stepEndpoint = (app, lockedData) => {
	app.get("/__motia/step/:stepId", async (req, res) => {
		const id = req.params.stepId;
		const step = [...lockedData.activeSteps, ...lockedData.devSteps].find((step$1) => generateStepId(step$1.filePath) === id);
		if (!step) {
			res.status(404).send({ error: "Step not found" });
			return;
		}
		try {
			const content = await fs.readFile(step.filePath, "utf8");
			const features = await getFeatures(step.filePath.replace(`${path.sep}src${path.sep}`, `${path.sep}tutorial${path.sep}`));
			res.status(200).send({
				id,
				content,
				features
			});
		} catch (error) {
			console.error("Error reading step file:", error);
			res.status(500).send({ error: "Failed to read step file" });
		}
	});
};

//#endregion
export { stepEndpoint };
//# sourceMappingURL=step-endpoint.mjs.map