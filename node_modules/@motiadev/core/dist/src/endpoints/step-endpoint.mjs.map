{"version":3,"file":"step-endpoint.mjs","names":["step"],"sources":["../../../src/endpoints/step-endpoint.ts"],"sourcesContent":["import path from 'node:path'\nimport type { Express } from 'express'\nimport fs from 'fs/promises'\nimport { generateStepId } from '../helper/flows-helper'\nimport type { LockedData } from '../locked-data'\n\nconst getFeatures = async (filePath: string) => {\n  const stat = await fs.stat(`${filePath}-features.json`).catch(() => null)\n\n  if (!stat || stat.isDirectory()) {\n    return []\n  }\n\n  try {\n    const content = await fs.readFile(`${filePath}-features.json`, 'utf8')\n    return JSON.parse(content)\n  } catch {\n    return []\n  }\n}\n\nexport const stepEndpoint = (app: Express, lockedData: LockedData) => {\n  app.get('/__motia/step/:stepId', async (req, res) => {\n    const id = req.params.stepId\n\n    const allSteps = [...lockedData.activeSteps, ...lockedData.devSteps]\n    const step = allSteps.find((step) => generateStepId(step.filePath) === id)\n\n    if (!step) {\n      res.status(404).send({ error: 'Step not found' })\n      return\n    }\n\n    try {\n      const content = await fs.readFile(step.filePath, 'utf8')\n      const features = await getFeatures(\n        step.filePath.replace(`${path.sep}src${path.sep}`, `${path.sep}tutorial${path.sep}`),\n      )\n\n      res.status(200).send({ id, content, features })\n    } catch (error) {\n      console.error('Error reading step file:', error)\n      res.status(500).send({\n        error: 'Failed to read step file',\n      })\n    }\n  })\n}\n"],"mappings":";;;;;AAMA,MAAM,cAAc,OAAO,aAAqB;CAC9C,MAAM,OAAO,MAAM,GAAG,KAAK,GAAG,SAAS,gBAAgB,CAAC,YAAY,KAAK;AAEzE,KAAI,CAAC,QAAQ,KAAK,aAAa,CAC7B,QAAO,EAAE;AAGX,KAAI;EACF,MAAM,UAAU,MAAM,GAAG,SAAS,GAAG,SAAS,iBAAiB,OAAO;AACtE,SAAO,KAAK,MAAM,QAAQ;SACpB;AACN,SAAO,EAAE;;;AAIb,MAAa,gBAAgB,KAAc,eAA2B;AACpE,KAAI,IAAI,yBAAyB,OAAO,KAAK,QAAQ;EACnD,MAAM,KAAK,IAAI,OAAO;EAGtB,MAAM,OADW,CAAC,GAAG,WAAW,aAAa,GAAG,WAAW,SAAS,CAC9C,MAAM,WAAS,eAAeA,OAAK,SAAS,KAAK,GAAG;AAE1E,MAAI,CAAC,MAAM;AACT,OAAI,OAAO,IAAI,CAAC,KAAK,EAAE,OAAO,kBAAkB,CAAC;AACjD;;AAGF,MAAI;GACF,MAAM,UAAU,MAAM,GAAG,SAAS,KAAK,UAAU,OAAO;GACxD,MAAM,WAAW,MAAM,YACrB,KAAK,SAAS,QAAQ,GAAG,KAAK,IAAI,KAAK,KAAK,OAAO,GAAG,KAAK,IAAI,UAAU,KAAK,MAAM,CACrF;AAED,OAAI,OAAO,IAAI,CAAC,KAAK;IAAE;IAAI;IAAS;IAAU,CAAC;WACxC,OAAO;AACd,WAAQ,MAAM,4BAA4B,MAAM;AAChD,OAAI,OAAO,IAAI,CAAC,KAAK,EACnB,OAAO,4BACR,CAAC;;GAEJ"}