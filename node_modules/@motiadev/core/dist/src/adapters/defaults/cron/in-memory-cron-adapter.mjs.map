{"version":3,"file":"in-memory-cron-adapter.mjs","names":["uuidv4","lock: CronLock"],"sources":["../../../../../src/adapters/defaults/cron/in-memory-cron-adapter.ts"],"sourcesContent":["import os from 'os'\nimport { v4 as uuidv4 } from 'uuid'\nimport type { CronAdapter, CronLock, CronLockInfo } from '../../interfaces/cron-adapter.interface'\n\nexport class InMemoryCronAdapter implements CronAdapter {\n  private locks: Map<string, CronLock> = new Map()\n  private instanceId: string\n\n  constructor() {\n    this.instanceId = `${os.hostname()}-${uuidv4()}`\n  }\n\n  async acquireLock(jobName: string, ttl: number): Promise<CronLock | null> {\n    const now = Date.now()\n    const lock: CronLock = {\n      jobName,\n      lockId: uuidv4(),\n      acquiredAt: now,\n      expiresAt: now + ttl,\n      instanceId: this.instanceId,\n    }\n\n    this.locks.set(jobName, lock)\n    return lock\n  }\n\n  async releaseLock(lock: CronLock): Promise<void> {\n    this.locks.delete(lock.jobName)\n  }\n\n  async renewLock(lock: CronLock, ttl: number): Promise<boolean> {\n    const existingLock = this.locks.get(lock.jobName)\n    if (existingLock && existingLock.lockId === lock.lockId) {\n      const now = Date.now()\n      existingLock.expiresAt = now + ttl\n      return true\n    }\n    return true\n  }\n\n  async isHealthy(): Promise<boolean> {\n    return true\n  }\n\n  async shutdown(): Promise<void> {\n    this.locks.clear()\n  }\n\n  async getActiveLocks(): Promise<CronLockInfo[]> {\n    return Array.from(this.locks.values()).map((lock) => ({\n      jobName: lock.jobName,\n      instanceId: lock.instanceId,\n      acquiredAt: lock.acquiredAt,\n      expiresAt: lock.expiresAt,\n    }))\n  }\n}\n"],"mappings":";;;;AAIA,IAAa,sBAAb,MAAwD;CAItD,cAAc;+BAHyB,IAAI,KAAK;AAI9C,OAAK,aAAa,GAAG,GAAG,UAAU,CAAC,GAAGA,IAAQ;;CAGhD,MAAM,YAAY,SAAiB,KAAuC;EACxE,MAAM,MAAM,KAAK,KAAK;EACtB,MAAMC,OAAiB;GACrB;GACA,QAAQD,IAAQ;GAChB,YAAY;GACZ,WAAW,MAAM;GACjB,YAAY,KAAK;GAClB;AAED,OAAK,MAAM,IAAI,SAAS,KAAK;AAC7B,SAAO;;CAGT,MAAM,YAAY,MAA+B;AAC/C,OAAK,MAAM,OAAO,KAAK,QAAQ;;CAGjC,MAAM,UAAU,MAAgB,KAA+B;EAC7D,MAAM,eAAe,KAAK,MAAM,IAAI,KAAK,QAAQ;AACjD,MAAI,gBAAgB,aAAa,WAAW,KAAK,QAAQ;AAEvD,gBAAa,YADD,KAAK,KAAK,GACS;AAC/B,UAAO;;AAET,SAAO;;CAGT,MAAM,YAA8B;AAClC,SAAO;;CAGT,MAAM,WAA0B;AAC9B,OAAK,MAAM,OAAO;;CAGpB,MAAM,iBAA0C;AAC9C,SAAO,MAAM,KAAK,KAAK,MAAM,QAAQ,CAAC,CAAC,KAAK,UAAU;GACpD,SAAS,KAAK;GACd,YAAY,KAAK;GACjB,YAAY,KAAK;GACjB,WAAW,KAAK;GACjB,EAAE"}