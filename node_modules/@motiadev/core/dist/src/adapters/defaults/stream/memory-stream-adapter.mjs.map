{"version":3,"file":"memory-stream-adapter.mjs","names":[],"sources":["../../../../../src/adapters/defaults/stream/memory-stream-adapter.ts"],"sourcesContent":["import { StreamAdapter } from '../../interfaces/stream-adapter.interface'\n\nexport class MemoryStreamAdapter<TData> extends StreamAdapter<TData> {\n  private state: Record<string, unknown> = {}\n\n  constructor(streamName: string) {\n    super(streamName)\n  }\n\n  async init() {\n    this.state = {}\n  }\n\n  async getGroup<T>(groupId: string): Promise<T[]> {\n    const prefix = this._makeKeyPrefix(groupId)\n    return Object.entries(this.state)\n      .filter(([key]) => key.startsWith(prefix))\n      .map(([key, value]) => {\n        const id = key.split(':').pop()\n        return { ...(value as object), id } as T\n      })\n  }\n\n  async get<T>(groupId: string, id: string): Promise<T | null> {\n    const key = this._makeKey(groupId, id)\n    const value = this.state[key]\n\n    return value ? ({ ...(value as object), id } as T) : null\n  }\n\n  async set<T>(groupId: string, id: string, value: T) {\n    const key = this._makeKey(groupId, id)\n\n    this.state[key] = value\n\n    return { ...value, id }\n  }\n\n  async delete<T>(groupId: string, id: string): Promise<T | null> {\n    const key = this._makeKey(groupId, id)\n    const value = await this.get<T>(groupId, id)\n\n    if (value) {\n      delete this.state[key]\n    }\n\n    return value\n  }\n\n  async clear(groupId: string): Promise<void> {\n    const prefix = this._makeKeyPrefix(groupId)\n    for (const key in this.state) {\n      if (key.startsWith(prefix)) {\n        delete this.state[key]\n      }\n    }\n  }\n\n  private _makeKeyPrefix(groupId: string) {\n    return `${this.streamName}:${groupId}`\n  }\n\n  private _makeKey(groupId: string, id: string) {\n    return `${this.streamName}:${groupId}:${id}`\n  }\n}\n"],"mappings":";;;AAEA,IAAa,sBAAb,cAAgD,cAAqB;CAGnE,YAAY,YAAoB;AAC9B,QAAM,WAAW;eAHsB,EAAE;;CAM3C,MAAM,OAAO;AACX,OAAK,QAAQ,EAAE;;CAGjB,MAAM,SAAY,SAA+B;EAC/C,MAAM,SAAS,KAAK,eAAe,QAAQ;AAC3C,SAAO,OAAO,QAAQ,KAAK,MAAM,CAC9B,QAAQ,CAAC,SAAS,IAAI,WAAW,OAAO,CAAC,CACzC,KAAK,CAAC,KAAK,WAAW;GACrB,MAAM,KAAK,IAAI,MAAM,IAAI,CAAC,KAAK;AAC/B,UAAO;IAAE,GAAI;IAAkB;IAAI;IACnC;;CAGN,MAAM,IAAO,SAAiB,IAA+B;EAC3D,MAAM,MAAM,KAAK,SAAS,SAAS,GAAG;EACtC,MAAM,QAAQ,KAAK,MAAM;AAEzB,SAAO,QAAS;GAAE,GAAI;GAAkB;GAAI,GAAS;;CAGvD,MAAM,IAAO,SAAiB,IAAY,OAAU;EAClD,MAAM,MAAM,KAAK,SAAS,SAAS,GAAG;AAEtC,OAAK,MAAM,OAAO;AAElB,SAAO;GAAE,GAAG;GAAO;GAAI;;CAGzB,MAAM,OAAU,SAAiB,IAA+B;EAC9D,MAAM,MAAM,KAAK,SAAS,SAAS,GAAG;EACtC,MAAM,QAAQ,MAAM,KAAK,IAAO,SAAS,GAAG;AAE5C,MAAI,MACF,QAAO,KAAK,MAAM;AAGpB,SAAO;;CAGT,MAAM,MAAM,SAAgC;EAC1C,MAAM,SAAS,KAAK,eAAe,QAAQ;AAC3C,OAAK,MAAM,OAAO,KAAK,MACrB,KAAI,IAAI,WAAW,OAAO,CACxB,QAAO,KAAK,MAAM;;CAKxB,AAAQ,eAAe,SAAiB;AACtC,SAAO,GAAG,KAAK,WAAW,GAAG;;CAG/B,AAAQ,SAAS,SAAiB,IAAY;AAC5C,SAAO,GAAG,KAAK,WAAW,GAAG,QAAQ,GAAG"}