{"version":3,"file":"logger.mjs","names":["levelMap: Record<string, number>","isVerbose: boolean","meta: Record<string, unknown>","coreListeners: LogListener[]"],"sources":["../../src/logger.ts"],"sourcesContent":["import { prettyPrint } from './pretty-print'\n\nconst LEVELS = {\n  NOTSET: 0,\n  DEBUG: 10,\n  INFO: 20,\n  WARNING: 30,\n  ERROR: 40,\n  CRITICAL: 50,\n} as const\n\nconst levelMap: Record<string, number> = {\n  debug: LEVELS.DEBUG,\n  info: LEVELS.INFO,\n  warn: LEVELS.WARNING,\n  warning: LEVELS.WARNING,\n  error: LEVELS.ERROR,\n  critical: LEVELS.CRITICAL,\n}\n\nconst getLogLevel = (): number => {\n  const level = process.env.LOG_LEVEL ?? 'info'\n  return levelMap[level] ?? LEVELS.INFO\n}\n\nconst shouldLog = (messageLevel: number): boolean => {\n  return messageLevel >= getLogLevel()\n}\n\nexport type LogListener = (level: string, msg: string, args?: unknown) => void\n\nexport class Logger {\n  /**\n   * Why do we need two level of listeners?\n   *\n   * Core listeners pass along to children loggers.\n   *\n   * However, base listeners do not pass along to children loggers.\n   * Those are specific to each logger in the hierarchy.\n   */\n  private readonly listeners: LogListener[] = []\n\n  constructor(\n    readonly isVerbose: boolean = false,\n    private readonly meta: Record<string, unknown> = {},\n    private readonly coreListeners: LogListener[] = [],\n  ) {}\n\n  child(meta: Record<string, unknown>): Logger {\n    return new Logger(this.isVerbose, { ...this.meta, ...meta }, this.coreListeners)\n  }\n\n  private _log(level: string, msg: string, args?: any) {\n    const time = Date.now()\n    const meta = { ...this.meta, ...(args ?? {}) }\n    prettyPrint({ level, time, msg, ...meta }, !this.isVerbose)\n\n    this.coreListeners.forEach((listener) => listener(level, msg, meta))\n    this.listeners.forEach((listener) => listener(level, msg, meta))\n  }\n\n  info(message: string, args?: unknown) {\n    if (shouldLog(LEVELS.INFO)) {\n      this._log('info', message, args)\n    }\n  }\n\n  error(message: string, args?: unknown) {\n    if (shouldLog(LEVELS.ERROR)) {\n      this._log('error', message, args)\n    }\n  }\n\n  debug(message: string, args?: unknown) {\n    if (shouldLog(LEVELS.DEBUG)) {\n      this._log('debug', message, args)\n    }\n  }\n\n  warn(message: string, args?: unknown) {\n    if (shouldLog(LEVELS.WARNING)) {\n      this._log('warn', message, args)\n    }\n  }\n\n  log(args: any) {\n    const level = args.level ?? 'info'\n    const messageLevel = levelMap[level] ?? LEVELS.INFO\n\n    if (!shouldLog(messageLevel)) return\n\n    this._log(level, args.msg, args)\n  }\n\n  addListener(listener: LogListener) {\n    this.listeners.push(listener)\n  }\n\n  removeListener(listener: LogListener): boolean {\n    const index = this.listeners.indexOf(listener)\n    if (index !== -1) {\n      this.listeners.splice(index, 1)\n      return true\n    }\n    return false\n  }\n}\n\nexport const globalLogger = new Logger()\n"],"mappings":";;;AAEA,MAAM,SAAS;CACb,QAAQ;CACR,OAAO;CACP,MAAM;CACN,SAAS;CACT,OAAO;CACP,UAAU;CACX;AAED,MAAMA,WAAmC;CACvC,OAAO,OAAO;CACd,MAAM,OAAO;CACb,MAAM,OAAO;CACb,SAAS,OAAO;CAChB,OAAO,OAAO;CACd,UAAU,OAAO;CAClB;AAED,MAAM,oBAA4B;AAEhC,QAAO,SADO,QAAQ,IAAI,aAAa,WACb,OAAO;;AAGnC,MAAM,aAAa,iBAAkC;AACnD,QAAO,gBAAgB,aAAa;;AAKtC,IAAa,SAAb,MAAa,OAAO;CAWlB,YACE,AAASC,YAAqB,OAC9B,AAAiBC,OAAgC,EAAE,EACnD,AAAiBC,gBAA+B,EAAE,EAClD;EAHS;EACQ;EACA;mBALyB,EAAE;;CAQ9C,MAAM,MAAuC;AAC3C,SAAO,IAAI,OAAO,KAAK,WAAW;GAAE,GAAG,KAAK;GAAM,GAAG;GAAM,EAAE,KAAK,cAAc;;CAGlF,AAAQ,KAAK,OAAe,KAAa,MAAY;EACnD,MAAM,OAAO,KAAK,KAAK;EACvB,MAAM,OAAO;GAAE,GAAG,KAAK;GAAM,GAAI,QAAQ,EAAE;GAAG;AAC9C,cAAY;GAAE;GAAO;GAAM;GAAK,GAAG;GAAM,EAAE,CAAC,KAAK,UAAU;AAE3D,OAAK,cAAc,SAAS,aAAa,SAAS,OAAO,KAAK,KAAK,CAAC;AACpE,OAAK,UAAU,SAAS,aAAa,SAAS,OAAO,KAAK,KAAK,CAAC;;CAGlE,KAAK,SAAiB,MAAgB;AACpC,MAAI,UAAU,OAAO,KAAK,CACxB,MAAK,KAAK,QAAQ,SAAS,KAAK;;CAIpC,MAAM,SAAiB,MAAgB;AACrC,MAAI,UAAU,OAAO,MAAM,CACzB,MAAK,KAAK,SAAS,SAAS,KAAK;;CAIrC,MAAM,SAAiB,MAAgB;AACrC,MAAI,UAAU,OAAO,MAAM,CACzB,MAAK,KAAK,SAAS,SAAS,KAAK;;CAIrC,KAAK,SAAiB,MAAgB;AACpC,MAAI,UAAU,OAAO,QAAQ,CAC3B,MAAK,KAAK,QAAQ,SAAS,KAAK;;CAIpC,IAAI,MAAW;EACb,MAAM,QAAQ,KAAK,SAAS;AAG5B,MAAI,CAAC,UAFgB,SAAS,UAAU,OAAO,KAEnB,CAAE;AAE9B,OAAK,KAAK,OAAO,KAAK,KAAK,KAAK;;CAGlC,YAAY,UAAuB;AACjC,OAAK,UAAU,KAAK,SAAS;;CAG/B,eAAe,UAAgC;EAC7C,MAAM,QAAQ,KAAK,UAAU,QAAQ,SAAS;AAC9C,MAAI,UAAU,IAAI;AAChB,QAAK,UAAU,OAAO,OAAO,EAAE;AAC/B,UAAO;;AAET,SAAO;;;AAIX,MAAa,eAAe,IAAI,QAAQ"}