{"version":3,"file":"trace-manager.mjs","names":["traceStream: MotiaStream<Trace>","traceGroupStream: MotiaStream<TraceGroup>","traceGroup: TraceGroup","trace: Trace"],"sources":["../../../src/observability/trace-manager.ts"],"sourcesContent":["import type { MotiaStream } from '../types-stream'\nimport type { Trace, TraceGroup } from './types'\n\nexport class TraceManager {\n  constructor(\n    private readonly traceStream: MotiaStream<Trace>,\n    private readonly traceGroupStream: MotiaStream<TraceGroup>,\n    private readonly traceGroup: TraceGroup,\n    private readonly trace: Trace,\n  ) {\n    this.updateTrace().catch(() => {})\n  }\n\n  async updateTrace() {\n    await this.traceStream.set(this.traceGroup.id, this.trace.id, this.trace)\n  }\n\n  async updateTraceGroup() {\n    await this.traceGroupStream.set('default', this.traceGroup.id, this.traceGroup)\n  }\n\n  async getAllTracesForGroup(): Promise<Trace[]> {\n    return await this.traceStream.getGroup(this.traceGroup.id)\n  }\n\n  child(trace: Trace) {\n    return new TraceManager(this.traceStream, this.traceGroupStream, this.traceGroup, trace)\n  }\n}\n"],"mappings":";AAGA,IAAa,eAAb,MAAa,aAAa;CACxB,YACE,AAAiBA,aACjB,AAAiBC,kBACjB,AAAiBC,YACjB,AAAiBC,OACjB;EAJiB;EACA;EACA;EACA;AAEjB,OAAK,aAAa,CAAC,YAAY,GAAG;;CAGpC,MAAM,cAAc;AAClB,QAAM,KAAK,YAAY,IAAI,KAAK,WAAW,IAAI,KAAK,MAAM,IAAI,KAAK,MAAM;;CAG3E,MAAM,mBAAmB;AACvB,QAAM,KAAK,iBAAiB,IAAI,WAAW,KAAK,WAAW,IAAI,KAAK,WAAW;;CAGjF,MAAM,uBAAyC;AAC7C,SAAO,MAAM,KAAK,YAAY,SAAS,KAAK,WAAW,GAAG;;CAG5D,MAAM,OAAc;AAClB,SAAO,IAAI,aAAa,KAAK,aAAa,KAAK,kBAAkB,KAAK,YAAY,MAAM"}