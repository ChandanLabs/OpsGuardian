{"version":3,"file":"can-access.mjs","names":["filePath"],"sources":["../../../src/node/can-access.ts"],"sourcesContent":["import path from 'node:path'\nimport { pathToFileURL } from 'node:url'\n\ntype CanAccessPayload = {\n  subscription: { groupId: string; id?: string }\n  authContext?: unknown\n}\n\nfunction parsePayload(arg: string): CanAccessPayload {\n  try {\n    return JSON.parse(arg)\n  } catch {\n    throw new Error('Invalid payload for canAccess evaluation')\n  }\n}\n\nasync function runCanAccess(filePath: string, payload: CanAccessPayload) {\n  const module = await import(pathToFileURL(path.resolve(filePath)).href)\n\n  const config = module.config || module.default?.config\n\n  if (!config) {\n    throw new Error(`Config not found in module ${filePath}`)\n  }\n\n  const canAccess = config.canAccess\n\n  if (typeof canAccess !== 'function') {\n    process.send?.(true)\n    process.exit(0)\n  }\n\n  const result = await canAccess(payload.subscription, payload.authContext)\n  process.send?.(Boolean(result))\n  process.exit(0)\n}\n\nconst [, , filePath, payloadArg] = process.argv\n\nif (!filePath || !payloadArg) {\n  console.error('Usage: node can-access.mjs <file-path> <payload>')\n  process.exit(1)\n}\n\nrunCanAccess(filePath, parsePayload(payloadArg))\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error('Error evaluating canAccess:', error)\n    process.exit(1)\n  })\n"],"mappings":";;;;AAQA,SAAS,aAAa,KAA+B;AACnD,KAAI;AACF,SAAO,KAAK,MAAM,IAAI;SAChB;AACN,QAAM,IAAI,MAAM,2CAA2C;;;AAI/D,eAAe,aAAa,YAAkB,SAA2B;CACvE,MAAM,SAAS,MAAM,OAAO,cAAc,KAAK,QAAQA,WAAS,CAAC,CAAC;CAElE,MAAM,SAAS,OAAO,UAAU,OAAO,SAAS;AAEhD,KAAI,CAAC,OACH,OAAM,IAAI,MAAM,8BAA8BA,aAAW;CAG3D,MAAM,YAAY,OAAO;AAEzB,KAAI,OAAO,cAAc,YAAY;AACnC,UAAQ,OAAO,KAAK;AACpB,UAAQ,KAAK,EAAE;;CAGjB,MAAM,SAAS,MAAM,UAAU,QAAQ,cAAc,QAAQ,YAAY;AACzE,SAAQ,OAAO,QAAQ,OAAO,CAAC;AAC/B,SAAQ,KAAK,EAAE;;AAGjB,MAAM,KAAK,UAAU,cAAc,QAAQ;AAE3C,IAAI,CAAC,YAAY,CAAC,YAAY;AAC5B,SAAQ,MAAM,mDAAmD;AACjE,SAAQ,KAAK,EAAE;;AAGjB,aAAa,UAAU,aAAa,WAAW,CAAC,CAC7C,WAAW,QAAQ,KAAK,EAAE,CAAC,CAC3B,OAAO,UAAU;AAChB,SAAQ,MAAM,+BAA+B,MAAM;AACnD,SAAQ,KAAK,EAAE;EACf"}