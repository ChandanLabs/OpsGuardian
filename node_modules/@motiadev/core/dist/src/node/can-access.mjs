import path from "node:path";
import { pathToFileURL } from "node:url";

//#region src/node/can-access.ts
function parsePayload(arg) {
	try {
		return JSON.parse(arg);
	} catch {
		throw new Error("Invalid payload for canAccess evaluation");
	}
}
async function runCanAccess(filePath$1, payload) {
	const module = await import(pathToFileURL(path.resolve(filePath$1)).href);
	const config = module.config || module.default?.config;
	if (!config) throw new Error(`Config not found in module ${filePath$1}`);
	const canAccess = config.canAccess;
	if (typeof canAccess !== "function") {
		process.send?.(true);
		process.exit(0);
	}
	const result = await canAccess(payload.subscription, payload.authContext);
	process.send?.(Boolean(result));
	process.exit(0);
}
const [, , filePath, payloadArg] = process.argv;
if (!filePath || !payloadArg) {
	console.error("Usage: node can-access.mjs <file-path> <payload>");
	process.exit(1);
}
runCanAccess(filePath, parsePayload(payloadArg)).then(() => process.exit(0)).catch((error) => {
	console.error("Error evaluating canAccess:", error);
	process.exit(1);
});

//#endregion
export {  };
//# sourceMappingURL=can-access.mjs.map