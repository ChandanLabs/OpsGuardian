{"version":3,"file":"logger.mjs","names":["traceId: string","flows: string[]","sender: RpcSender"],"sources":["../../../src/node/logger.ts"],"sourcesContent":["import type { RpcSender } from './rpc'\n\nexport type LogListener = (level: string, message: string, args?: unknown) => void\n\nexport class Logger {\n  private readonly listeners: LogListener[] = []\n\n  constructor(\n    private readonly traceId: string,\n    private readonly flows: string[],\n    private readonly sender: RpcSender,\n  ) {}\n\n  private _log(level: string, message: string, args?: Record<string, unknown>): void {\n    const argsCopy = args ? { ...args } : {}\n\n    if (argsCopy.error && argsCopy.error instanceof Error) {\n      argsCopy.error = {\n        ...argsCopy.error,\n        message: argsCopy.error.message,\n        stack: argsCopy.error.stack,\n        name: argsCopy.error.name,\n      }\n    }\n\n    const logEntry = {\n      ...argsCopy,\n      level,\n      time: Date.now(),\n      traceId: this.traceId,\n      flows: this.flows,\n      msg: message,\n    }\n\n    this.sender.sendNoWait('log', logEntry)\n\n    this.listeners.forEach((listener) => listener(level, message, args))\n  }\n\n  info(message: string, args?: Record<string, unknown>): void {\n    this._log('info', message, args)\n  }\n\n  error(message: string, args?: Record<string, unknown>): void {\n    this._log('error', message, args)\n  }\n\n  debug(message: string, args?: Record<string, unknown>): void {\n    this._log('debug', message, args)\n  }\n\n  warn(message: string, args?: Record<string, unknown>): void {\n    this._log('warn', message, args)\n  }\n\n  addListener(listener: LogListener) {\n    this.listeners.push(listener)\n  }\n}\n"],"mappings":";AAIA,IAAa,SAAb,MAAoB;CAGlB,YACE,AAAiBA,SACjB,AAAiBC,OACjB,AAAiBC,QACjB;EAHiB;EACA;EACA;mBALyB,EAAE;;CAQ9C,AAAQ,KAAK,OAAe,SAAiB,MAAsC;EACjF,MAAM,WAAW,OAAO,EAAE,GAAG,MAAM,GAAG,EAAE;AAExC,MAAI,SAAS,SAAS,SAAS,iBAAiB,MAC9C,UAAS,QAAQ;GACf,GAAG,SAAS;GACZ,SAAS,SAAS,MAAM;GACxB,OAAO,SAAS,MAAM;GACtB,MAAM,SAAS,MAAM;GACtB;EAGH,MAAM,WAAW;GACf,GAAG;GACH;GACA,MAAM,KAAK,KAAK;GAChB,SAAS,KAAK;GACd,OAAO,KAAK;GACZ,KAAK;GACN;AAED,OAAK,OAAO,WAAW,OAAO,SAAS;AAEvC,OAAK,UAAU,SAAS,aAAa,SAAS,OAAO,SAAS,KAAK,CAAC;;CAGtE,KAAK,SAAiB,MAAsC;AAC1D,OAAK,KAAK,QAAQ,SAAS,KAAK;;CAGlC,MAAM,SAAiB,MAAsC;AAC3D,OAAK,KAAK,SAAS,SAAS,KAAK;;CAGnC,MAAM,SAAiB,MAAsC;AAC3D,OAAK,KAAK,SAAS,SAAS,KAAK;;CAGnC,KAAK,SAAiB,MAAsC;AAC1D,OAAK,KAAK,QAAQ,SAAS,KAAK;;CAGlC,YAAY,UAAuB;AACjC,OAAK,UAAU,KAAK,SAAS"}