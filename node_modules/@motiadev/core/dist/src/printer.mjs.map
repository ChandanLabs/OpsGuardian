{"version":3,"file":"printer.mjs","names":["baseDir: string","step","error"],"sources":["../../src/printer.ts"],"sourcesContent":["import path from 'path'\nimport pc from 'picocolors'\nimport { isApiStep, isCronStep, isEventStep, isNoopStep } from './guards'\nimport type { ValidationError } from './step-validator'\nimport type { Step } from './types'\nimport type { Stream } from './types-stream'\n\nconst stepTag = pc.bold(pc.magenta('Step'))\nconst flowTag = pc.bold(pc.blue('Flow'))\nconst streamTag = pc.bold(pc.green('Stream'))\nconst registered = pc.green('➜ [REGISTERED]')\nconst building = pc.yellow('⚡ [BUILDING]')\nconst built = pc.green('✓ [BUILT]')\nconst updated = pc.yellow('➜ [UPDATED]')\nconst removed = pc.red('➜ [REMOVED]')\nconst invalidEmit = pc.red('➜ [INVALID EMIT]')\nconst error = pc.red('[ERROR]')\nconst warning = pc.yellow('[WARNING]')\nconst warnIcon = pc.yellow('⚠')\nconst infoIcon = pc.blue('ℹ')\nconst errorIcon = pc.red('✖')\n\nexport class Printer {\n  constructor(private readonly baseDir: string) {}\n\n  stepTag = stepTag\n  flowTag = flowTag\n  registered = registered\n  building = building\n  built = built\n  updated = updated\n  removed = removed\n\n  printEventInputValidationError(\n    emit: { topic: string },\n    details: { missingFields?: string[]; extraFields?: string[]; typeMismatches?: string[] },\n  ) {\n    const emitPath = pc.bold(pc.cyan(`Emit ${emit.topic}`))\n\n    console.log(`${warnIcon} ${warning} ${emitPath} validation issues:`)\n\n    const hasAny = details.missingFields?.length || details.extraFields?.length || details.typeMismatches?.length\n\n    if (!hasAny) {\n      console.log(`${pc.yellow('│')} No issues found.`)\n      console.log(`${pc.yellow('└─')} Validation passed.`)\n      return\n    }\n\n    if (details.missingFields?.length) {\n      console.log(`${pc.yellow('│')} ${pc.yellow(`⚠ Missing fields: ${details.missingFields.join(', ')}`)}`)\n    }\n\n    if (details.extraFields?.length) {\n      console.log(`${pc.yellow('│')} ${pc.yellow(`⚠ Extra fields: ${details.extraFields.join(', ')}`)}`)\n    }\n\n    if (details.typeMismatches?.length) {\n      console.log(`${pc.yellow('│')} ${pc.yellow(`⚠ Type mismatches: ${details.typeMismatches.join(', ')}`)}`)\n    }\n\n    console.log(`${pc.yellow('└─')} ${pc.yellow('Payload does not match schema.')}`)\n  }\n\n  printInvalidEmit(step: Step, emit: string) {\n    console.log(\n      `${invalidEmit} ${stepTag} ${this.getStepType(step)} ${this.getStepPath(step)} tried to emit an event not defined in the step config: ${pc.yellow(emit)}`,\n    )\n  }\n\n  printStepCreated(step: Step) {\n    console.log(`${registered} ${stepTag} ${this.getStepType(step)} ${this.getStepPath(step)} registered`)\n  }\n\n  printStepUpdated(step: Step) {\n    console.log(`${updated} ${stepTag} ${this.getStepType(step)} ${this.getStepPath(step)} updated`)\n  }\n\n  printStepRemoved(step: Step) {\n    console.log(`${removed} ${stepTag} ${this.getStepType(step)} ${this.getStepPath(step)} removed`)\n  }\n\n  printFlowCreated(flowName: string) {\n    console.log(`${registered} ${flowTag} ${pc.bold(pc.cyan(flowName))} registered`)\n  }\n\n  printFlowUpdated(flowName: string) {\n    console.log(`${updated} ${flowTag} ${pc.bold(pc.cyan(flowName))} updated`)\n  }\n\n  printFlowRemoved(flowName: string) {\n    console.log(`${removed} ${flowTag} ${pc.bold(pc.cyan(flowName))} removed`)\n  }\n\n  printStreamCreated(stream: Stream) {\n    console.log(`${registered} ${streamTag} ${this.getStreamPath(stream)} registered`)\n  }\n\n  printStreamUpdated(stream: Stream) {\n    console.log(`${updated} ${streamTag} ${this.getStreamPath(stream)} updated`)\n  }\n\n  printStreamRemoved(stream: Stream) {\n    console.log(`${removed} ${streamTag} ${this.getStreamPath(stream)} removed`)\n  }\n\n  printInvalidEmitConfiguration(step: Step, emit: string) {\n    console.log(\n      `${warnIcon} ${warning} ${stepTag} ${this.getStepType(step)} ${this.getStepPath(step)} emits to ${pc.yellow(emit)}, but there is no subscriber defined`,\n    )\n  }\n\n  printInvalidSchema(topic: string, step: Step[]) {\n    console.log(`${error} Topic ${pc.bold(pc.blue(topic))} has incompatible schemas in the following steps:`)\n    step.forEach((step) => {\n      console.log(`${pc.red('  ✖')} ${this.getStepPath(step)}`)\n    })\n  }\n\n  printValidationError(stepPath: string, validationError: ValidationError) {\n    const relativePath = this.getRelativePath(stepPath)\n\n    console.log(`${error} ${pc.bold(pc.cyan(relativePath))}`)\n    validationError.errors?.forEach((error) => {\n      if (error.path) {\n        console.log(`${pc.red('│')} ${pc.yellow(`✖ ${error.path}`)}: ${error.message}`)\n      } else {\n        console.log(`${pc.red('│')} ${pc.yellow('✖')} ${error.message}`)\n      }\n    })\n    console.log(`${pc.red('└─')} ${pc.red(validationError.error)}  `)\n  }\n\n  getRelativePath(filePath: string) {\n    return path.relative(this.baseDir, filePath)\n  }\n\n  getStepType(step: Step) {\n    if (isApiStep(step)) return pc.gray('(API)')\n    if (isEventStep(step)) return pc.gray('(Event)')\n    if (isCronStep(step)) return pc.gray('(Cron)')\n    if (isNoopStep(step)) return pc.gray('(Noop)')\n\n    return pc.gray('(Unknown)')\n  }\n\n  getStepPath(step: Step) {\n    const stepPath = this.getRelativePath(step.filePath)\n    return pc.bold(pc.cyan(stepPath))\n  }\n\n  getStreamPath(stream: Stream) {\n    const streamPath = this.getRelativePath(stream.filePath)\n    return pc.bold(pc.magenta(streamPath))\n  }\n\n  printPluginLog(message: string) {\n    const pluginTag = pc.bold(pc.cyan('[motia-plugins]'))\n    console.log(`${infoIcon} ${pluginTag} ${message}`)\n  }\n\n  printPluginWarn(message: string) {\n    const pluginTag = pc.bold(pc.cyan('[motia-plugins]'))\n    console.warn(`${warnIcon} ${pluginTag} ${pc.yellow(message)}`)\n  }\n\n  printPluginError(message: string, ...args: unknown[]) {\n    const pluginTag = pc.bold(pc.cyan('[motia-plugins]'))\n    console.error(`${errorIcon} ${pluginTag} ${pc.red(message)}`, ...args)\n  }\n}\n\nexport class NoPrinter extends Printer {\n  constructor() {\n    super('')\n  }\n\n  printEventInputValidationError() {}\n\n  printInvalidEmit() {}\n  printStepCreated() {}\n  printStepUpdated() {}\n  printStepRemoved() {}\n  printFlowCreated() {}\n  printFlowUpdated() {}\n  printFlowRemoved() {}\n  printStepType() {}\n  printStepPath() {}\n\n  printStreamCreated() {}\n  printStreamUpdated() {}\n  printStreamRemoved() {}\n\n  printPluginLog() {}\n  printPluginWarn() {}\n  printPluginError() {}\n}\n"],"mappings":"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"}