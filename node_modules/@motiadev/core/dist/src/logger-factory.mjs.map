{"version":3,"file":"logger-factory.mjs","names":["isVerbose: boolean","logStream: MotiaStream<Log>","streamListener: LogListener"],"sources":["../../src/logger-factory.ts"],"sourcesContent":["import { randomUUID } from 'crypto'\nimport { Logger, type LogListener } from './logger'\nimport type { Log } from './streams/redis-logs-stream'\nimport type { MotiaStream } from './types-stream'\n\ntype CreateLogger = {\n  traceId: string\n  flows?: string[]\n  stepName: string\n}\n\nexport interface LoggerFactory {\n  create: (args: CreateLogger) => Logger\n}\n\nexport class BaseLoggerFactory implements LoggerFactory {\n  constructor(\n    private readonly isVerbose: boolean,\n    private readonly logStream: MotiaStream<Log>,\n  ) {}\n\n  create({ stepName, traceId, flows }: CreateLogger): Logger {\n    const streamListener: LogListener = (level, msg, args) => {\n      const id = randomUUID()\n\n      this.logStream.set('default', id, {\n        id,\n        ...(args ?? {}),\n        level,\n        time: Date.now(),\n        msg,\n        traceId,\n        flows: flows ?? [],\n      })\n    }\n\n    return new Logger(this.isVerbose, { traceId, flows, step: stepName }, [streamListener])\n  }\n}\n"],"mappings":";;;;AAeA,IAAa,oBAAb,MAAwD;CACtD,YACE,AAAiBA,WACjB,AAAiBC,WACjB;EAFiB;EACA;;CAGnB,OAAO,EAAE,UAAU,SAAS,SAA+B;EACzD,MAAMC,kBAA+B,OAAO,KAAK,SAAS;GACxD,MAAM,KAAK,YAAY;AAEvB,QAAK,UAAU,IAAI,WAAW,IAAI;IAChC;IACA,GAAI,QAAQ,EAAE;IACd;IACA,MAAM,KAAK,KAAK;IAChB;IACA;IACA,OAAO,SAAS,EAAE;IACnB,CAAC;;AAGJ,SAAO,IAAI,OAAO,KAAK,WAAW;GAAE;GAAS;GAAO,MAAM;GAAU,EAAE,CAAC,eAAe,CAAC"}