{"version":3,"file":"helpers.mjs","names":[],"sources":["../../../src/socket-server/helpers.ts"],"sourcesContent":["import type { WebSocket } from 'ws'\n\nexport type BaseMessage = { streamName: string; groupId: string; id?: string }\nexport type JoinMessage = BaseMessage & { subscriptionId: string }\nexport type StreamEvent<TData> =\n  | { type: 'sync'; data: TData }\n  | { type: 'create'; data: TData }\n  | { type: 'update'; data: TData }\n  | { type: 'delete'; data: TData }\n  | { type: 'event'; event: { type: string; data: unknown } }\nexport type EventMessage<TData> = BaseMessage & { timestamp: number; event: StreamEvent<TData> }\n\nexport const ACCESS_DENIED_CODE = 'STREAM_ACCESS_DENIED'\n\nexport const getRoom = (message: BaseMessage): string => {\n  return message.id ? `${message.streamName}:id:${message.id}` : `${message.streamName}:group-id:${message.groupId}`\n}\n\nexport const createErrorMessage = (data: BaseMessage, error: Error) => {\n  return {\n    timestamp: Date.now(),\n    streamName: data.streamName,\n    groupId: data.groupId,\n    id: data.id,\n    event: { type: 'event', event: { type: 'error', data: { code: ACCESS_DENIED_CODE, message: error.message } } },\n  }\n}\n\nexport const sendAccessDenied = (socket: WebSocket, data: BaseMessage) => {\n  const resultMessage = createErrorMessage(data, new Error('Access denied'))\n  socket.send(JSON.stringify(resultMessage))\n}\n\nexport const sendError = (socket: WebSocket, data: BaseMessage, error: Error) => {\n  const resultMessage = createErrorMessage(data, error)\n  socket.send(JSON.stringify(resultMessage))\n}\n"],"mappings":";AAYA,MAAa,qBAAqB;AAElC,MAAa,WAAW,YAAiC;AACvD,QAAO,QAAQ,KAAK,GAAG,QAAQ,WAAW,MAAM,QAAQ,OAAO,GAAG,QAAQ,WAAW,YAAY,QAAQ;;AAG3G,MAAa,sBAAsB,MAAmB,UAAiB;AACrE,QAAO;EACL,WAAW,KAAK,KAAK;EACrB,YAAY,KAAK;EACjB,SAAS,KAAK;EACd,IAAI,KAAK;EACT,OAAO;GAAE,MAAM;GAAS,OAAO;IAAE,MAAM;IAAS,MAAM;KAAE,MAAM;KAAoB,SAAS,MAAM;KAAS;IAAE;GAAE;EAC/G;;AAGH,MAAa,oBAAoB,QAAmB,SAAsB;CACxE,MAAM,gBAAgB,mBAAmB,sBAAM,IAAI,MAAM,gBAAgB,CAAC;AAC1E,QAAO,KAAK,KAAK,UAAU,cAAc,CAAC;;AAG5C,MAAa,aAAa,QAAmB,MAAmB,UAAiB;CAC/E,MAAM,gBAAgB,mBAAmB,MAAM,MAAM;AACrD,QAAO,KAAK,KAAK,UAAU,cAAc,CAAC"}