{"version":3,"file":"locked-data.mjs","names":["baseDir: string","streamAdapter: StreamAdapterManager","printer: Printer","redisClient?: RedisClientType","streams: Record<string, StreamFactory<unknown>>","path"],"sources":["../../src/locked-data.ts"],"sourcesContent":["import fs from 'fs'\nimport path from 'path'\nimport type { RedisClientType } from 'redis'\nimport type { StreamAdapter } from './adapters/interfaces/stream-adapter.interface'\nimport type { StreamAdapterManager } from './adapters/interfaces/stream-adapter-manager.interface'\nimport { isApiStep, isCronStep, isEventStep } from './guards'\nimport { PLUGIN_FLOW_ID } from './motia'\nimport type { Printer } from './printer'\nimport { validateStep } from './step-validator'\nimport type { StreamFactory } from './streams/stream-factory'\nimport type { ApiRouteConfig, CronConfig, EventConfig, Flow, Step } from './types'\nimport type { StreamAuthConfig } from './types/app-config-types'\nimport { generateTypeFromSchema } from './types/generate-type-from-schema'\nimport { generateTypesFromSteps, generateTypesFromStreams, generateTypesString } from './types/generate-types'\nimport type { JsonSchema } from './types/schema.types'\nimport type { Stream } from './types-stream'\n\ntype FlowEvent = 'flow-created' | 'flow-removed' | 'flow-updated'\ntype StepEvent = 'step-created' | 'step-removed' | 'step-updated'\ntype StreamEvent = 'stream-created' | 'stream-removed' | 'stream-updated'\n\ntype StreamWrapper<TData> = (streamName: string, factory: StreamFactory<TData>) => StreamFactory<TData>\n\nexport class LockedData {\n  public flows: Record<string, Flow>\n  public activeSteps: Step[]\n  public devSteps: Step[]\n\n  private stepsMap: Record<string, Step>\n  private handlers: Record<FlowEvent, ((flowName: string) => void)[]>\n  private stepHandlers: Record<StepEvent, ((step: Step) => void)[]>\n  private streamHandlers: Record<StreamEvent, ((stream: Stream) => void)[]>\n  private streams: Record<string, Stream>\n\n  private streamWrapper?: StreamWrapper<any>\n  private streamAuthContextType?: string\n  private streamAuthConfig?: { authenticate: StreamAuthConfig['authenticate'] }\n\n  constructor(\n    public readonly baseDir: string,\n    public readonly streamAdapter: StreamAdapterManager,\n    private readonly printer: Printer,\n    public readonly redisClient?: RedisClientType,\n  ) {\n    this.flows = {}\n    this.activeSteps = []\n    this.devSteps = []\n    this.stepsMap = {}\n\n    this.handlers = {\n      'flow-created': [],\n      'flow-removed': [],\n      'flow-updated': [],\n    }\n\n    this.stepHandlers = {\n      'step-created': [],\n      'step-removed': [],\n      'step-updated': [],\n    }\n\n    this.streamHandlers = {\n      'stream-created': [],\n      'stream-removed': [],\n      'stream-updated': [],\n    }\n\n    this.streams = {}\n  }\n\n  applyStreamWrapper<TData>(streamWrapper: StreamWrapper<TData>): void {\n    this.streamWrapper = streamWrapper\n  }\n\n  setStreamAuthConfig(config?: { authenticate: StreamAuthConfig['authenticate']; contextSchema?: JsonSchema }): void {\n    this.streamAuthConfig = config ? { authenticate: config.authenticate } : undefined\n    this.streamAuthContextType = config?.contextSchema ? generateTypeFromSchema(config.contextSchema) : undefined\n  }\n\n  getStreamAuthConfig() {\n    return this.streamAuthConfig\n  }\n\n  saveTypes() {\n    const types = generateTypesFromSteps(this.activeSteps, this.printer)\n    const streams = generateTypesFromStreams(this.streams)\n    const typesString = generateTypesString(types, streams, this.streamAuthContextType)\n    fs.writeFileSync(path.join(this.baseDir, 'types.d.ts'), typesString)\n  }\n\n  on(event: FlowEvent, handler: (flowName: string) => void) {\n    this.handlers[event].push(handler)\n  }\n\n  onStep(event: StepEvent, handler: (step: Step) => void) {\n    this.stepHandlers[event].push(handler)\n  }\n\n  onStream(event: StreamEvent, handler: (stream: Stream) => void) {\n    this.streamHandlers[event].push(handler)\n  }\n\n  getActiveSteps() {\n    return this.activeSteps.filter((step) => !step.config.flows?.includes(PLUGIN_FLOW_ID))\n  }\n\n  eventSteps(): Step<EventConfig>[] {\n    return this.getActiveSteps().filter(isEventStep)\n  }\n\n  apiSteps(): Step<ApiRouteConfig>[] {\n    return this.getActiveSteps().filter(isApiStep)\n  }\n\n  cronSteps(): Step<CronConfig>[] {\n    return this.getActiveSteps().filter(isCronStep)\n  }\n\n  pythonSteps(): Step[] {\n    return this.getActiveSteps().filter((step) => step.filePath.endsWith('.py'))\n  }\n\n  tsSteps(): Step[] {\n    return this.getActiveSteps().filter((step) => step.filePath.endsWith('.ts'))\n  }\n\n  getStreams(): Record<string, StreamFactory<any>> {\n    const streams: Record<string, StreamFactory<unknown>> = {}\n\n    for (const [key, value] of Object.entries(this.streams)) {\n      streams[key] = value.factory\n    }\n\n    return streams\n  }\n\n  listStreams(): Stream[] {\n    return Object.values(this.streams)\n  }\n\n  getStreamByName(streamName: string): Stream | undefined {\n    return this.streams[streamName]\n  }\n\n  findStream(path: string): Stream | undefined {\n    return Object.values(this.streams).find((stream) => stream.filePath === path)\n  }\n\n  updateStep(oldStep: Step, newStep: Step, options: { disableTypeCreation?: boolean } = {}): boolean {\n    if (!this.isValidStep(newStep)) {\n      this.deleteStep(oldStep)\n\n      return false\n    }\n\n    if (oldStep.config.type !== newStep.config.type) {\n      this.activeSteps = this.activeSteps.filter((s) => s.filePath !== oldStep.filePath)\n      this.devSteps = this.devSteps.filter((s) => s.filePath !== oldStep.filePath)\n\n      if (newStep.config.type === 'noop') {\n        this.devSteps.push(newStep)\n      } else {\n        this.activeSteps.push(newStep)\n      }\n    }\n\n    const savedStep = this.stepsMap[newStep.filePath]\n    const addedFlows = newStep.config.flows?.filter((flowName) => !oldStep.config.flows?.includes(flowName)) ?? []\n    const removedFlows = oldStep.config.flows?.filter((flowName) => !newStep.config.flows?.includes(flowName)) ?? []\n    const untouchedFlows = oldStep.config.flows?.filter((flowName) => newStep.config.flows?.includes(flowName)) ?? []\n    savedStep.config = newStep.config\n\n    untouchedFlows.forEach((flowName) => this.onFlowUpdated(flowName))\n\n    for (const flowName of addedFlows) {\n      if (!this.flows[flowName]) {\n        const flow = this.createFlow(flowName)\n        flow.steps.push(savedStep)\n      } else {\n        this.flows[flowName].steps.push(savedStep)\n        this.onFlowUpdated(flowName)\n      }\n    }\n\n    for (const flowName of removedFlows) {\n      const flowSteps = this.flows[flowName].steps\n      this.flows[flowName].steps = flowSteps.filter(({ filePath }) => filePath !== newStep.filePath)\n\n      if (this.flows[flowName].steps.length === 0) {\n        this.removeFlow(flowName)\n      } else {\n        this.onFlowUpdated(flowName)\n      }\n    }\n\n    if (!options.disableTypeCreation) {\n      this.saveTypes()\n    }\n\n    this.stepHandlers['step-updated'].forEach((handler) => handler(newStep))\n    this.printer.printStepUpdated(newStep)\n\n    return true\n  }\n\n  createStep(step: Step, options: { disableTypeCreation?: boolean } = {}): boolean {\n    if (!this.isValidStep(step)) {\n      return false\n    }\n\n    this.stepsMap[step.filePath] = step\n\n    if (step.config.type === 'noop') {\n      this.devSteps.push(step)\n    } else {\n      this.activeSteps.push(step)\n    }\n\n    for (const flowName of step.config.flows ?? []) {\n      if (!this.flows[flowName]) {\n        const flow = this.createFlow(flowName)\n        flow.steps.push(step)\n      } else {\n        this.flows[flowName].steps.push(step)\n        this.onFlowUpdated(flowName)\n      }\n    }\n\n    if (!options.disableTypeCreation) {\n      this.saveTypes()\n    }\n\n    this.stepHandlers['step-created'].forEach((handler) => handler(step))\n    this.printer.printStepCreated(step)\n\n    return true\n  }\n\n  deleteStep(step: Step, options: { disableTypeCreation?: boolean } = {}): void {\n    // Remove step from active and dev steps\n    this.activeSteps = this.activeSteps.filter(({ filePath }) => filePath !== step.filePath)\n    this.devSteps = this.devSteps.filter(({ filePath }) => filePath !== step.filePath)\n\n    delete this.stepsMap[step.filePath]\n\n    for (const flowName of step.config.flows ?? []) {\n      const stepFlows = this.flows[flowName]?.steps\n\n      if (stepFlows) {\n        this.flows[flowName].steps = stepFlows.filter(({ filePath }) => filePath !== step.filePath)\n      }\n\n      if (this.flows[flowName].steps.length === 0) {\n        this.removeFlow(flowName)\n      } else {\n        this.onFlowUpdated(flowName)\n      }\n    }\n\n    if (!options.disableTypeCreation) {\n      this.saveTypes()\n    }\n\n    this.stepHandlers['step-removed'].forEach((handler) => handler(step))\n    this.printer.printStepRemoved(step)\n  }\n\n  private createFactoryWrapper<TData>(stream: Stream, factory: StreamFactory<TData>): StreamFactory<TData> {\n    return () => {\n      const streamFactory = this.streamWrapper //\n        ? this.streamWrapper(stream.config.name, factory)\n        : factory\n      return streamFactory()\n    }\n  }\n\n  createStream<TData>(\n    baseStream: Omit<Stream, 'factory'>,\n    options: { disableTypeCreation?: boolean } = {},\n  ): StreamFactory<TData> {\n    const stream = baseStream as Stream\n\n    this.streams[stream.config.name] = stream\n    this.streamHandlers['stream-created'].forEach((handler) => handler(stream))\n\n    if (stream.config.baseConfig.storageType === 'default') {\n      stream.factory = this.createFactoryWrapper(stream, () => this.createStreamAdapter(stream.config.name))\n    } else {\n      stream.factory = this.createFactoryWrapper(stream, stream.config.baseConfig.factory)\n    }\n\n    if (!stream.hidden) {\n      this.printer.printStreamCreated(stream)\n\n      if (!options.disableTypeCreation) {\n        this.saveTypes()\n      }\n    }\n\n    return stream.factory as StreamFactory<TData>\n  }\n\n  deleteStream(stream: Stream, options: { disableTypeCreation?: boolean } = {}): void {\n    Object.entries(this.streams).forEach(([streamName, { filePath }]) => {\n      if (stream.filePath === filePath) {\n        delete this.streams[streamName]\n      }\n    })\n\n    this.streamHandlers['stream-removed'].forEach((handler) => handler(stream))\n\n    if (!stream.hidden) {\n      this.printer.printStreamRemoved(stream)\n\n      if (!options.disableTypeCreation) {\n        this.saveTypes()\n      }\n    }\n  }\n\n  updateStream(oldStream: Stream, stream: Stream, options: { disableTypeCreation?: boolean } = {}): void {\n    if (oldStream.config.name !== stream.config.name) {\n      delete this.streams[oldStream.config.name]\n    }\n\n    if (stream.config.baseConfig.storageType === 'default') {\n      stream.factory = this.createFactoryWrapper(stream, () => this.createStreamAdapter(stream.config.name))\n    } else {\n      stream.factory = this.createFactoryWrapper(stream, stream.config.baseConfig.factory)\n    }\n\n    this.streams[stream.config.name] = stream\n    this.streamHandlers['stream-updated'].forEach((handler) => handler(stream))\n\n    if (!stream.hidden) {\n      this.printer.printStreamUpdated(stream)\n\n      if (!options.disableTypeCreation) {\n        this.saveTypes()\n      }\n    }\n  }\n\n  private createFlow(flowName: string): Flow {\n    const flow = { name: flowName, description: '', steps: [] }\n    this.flows[flowName] = flow\n    this.handlers['flow-created'].forEach((handler) => handler(flowName))\n    this.printer.printFlowCreated(flowName)\n\n    return flow\n  }\n\n  private removeFlow(flowName: string): void {\n    delete this.flows[flowName]\n    this.handlers['flow-removed'].forEach((handler) => handler(flowName))\n    this.printer.printFlowRemoved(flowName)\n  }\n\n  private onFlowUpdated(flowName: string): void {\n    this.handlers['flow-updated'].forEach((handler) => handler(flowName))\n  }\n\n  private isValidStep(step: Step): boolean {\n    const validationResult = validateStep(step)\n\n    if (!validationResult.success) {\n      this.printer.printValidationError(step.filePath, validationResult)\n    }\n\n    return validationResult.success\n  }\n\n  private createStreamAdapter<TData>(streamName: string): StreamAdapter<TData> {\n    return this.streamAdapter.createStream<TData>(streamName)\n  }\n}\n"],"mappings":"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"}