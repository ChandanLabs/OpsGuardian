{"version":3,"file":"schema-utils.mjs","names":["z"],"sources":["../../src/schema-utils.ts"],"sourcesContent":["import type { StandardSchemaV1 } from '@standard-schema/spec'\nimport * as z from 'zod'\nimport type { JsonSchema } from './types/schema.types'\n\n// export interface StandardSchema<T = unknown> {\n//     parse: (data: unknown) => T\n//     safeParse: (data: unknown) => { success: true; data: T } | { success: false; error: unknown }\n//     validate?: (data: unknown) => boolean\n//     toJSON?: () => JsonSchema\n// }\n\nexport type SchemaInput = StandardSchemaV1 | z.ZodType | JsonSchema | null | undefined\n\nexport function isStandardSchema(value: unknown): value is StandardSchemaV1 {\n  if (!value || typeof value !== 'object') {\n    return false\n  }\n\n  const schema = value as Record<string, unknown>\n\n  return '~standard' in schema && schema['~standard'] !== null && typeof schema['~standard'] === 'object'\n}\n\nexport function isZodSchema(value: unknown): value is z.ZodType {\n  return Boolean(\n    value &&\n      typeof value === 'object' &&\n      typeof (value as z.ZodType).safeParse === 'function' &&\n      '_zod' in (value as z.ZodType) &&\n      typeof (value as z.ZodType & { _zod: { def: unknown } })._zod === 'object' &&\n      'def' in (value as z.ZodType & { _zod: { def: unknown } })._zod,\n  )\n}\n\nexport function isJsonSchema(value: unknown): value is JsonSchema {\n  if (!value || typeof value !== 'object') {\n    return false\n  }\n  const schema = value as Record<string, unknown>\n  return typeof schema.type === 'string' || Array.isArray(schema.type) || 'properties' in schema\n}\n\nexport function schemaToJsonSchema(schema: SchemaInput): JsonSchema | null {\n  if (!schema) {\n    return null\n  }\n\n  if (isZodSchema(schema)) {\n    return z.toJSONSchema(schema, { target: 'draft-7' }) as JsonSchema\n  }\n\n  // Check isJsonSchema BEFORE isStandardSchema\n  // because Zod 4's toJSONSchema() output includes ~standard marker\n  if (isJsonSchema(schema)) {\n    return schema as JsonSchema\n  }\n\n  if (isStandardSchema(schema)) {\n    if ('toJSON' in schema && typeof schema.toJSON === 'function') {\n      return schema.toJSON() as JsonSchema\n    }\n    return null\n  }\n\n  return null\n}\n"],"mappings":";;;AAaA,SAAgB,iBAAiB,OAA2C;AAC1E,KAAI,CAAC,SAAS,OAAO,UAAU,SAC7B,QAAO;CAGT,MAAM,SAAS;AAEf,QAAO,eAAe,UAAU,OAAO,iBAAiB,QAAQ,OAAO,OAAO,iBAAiB;;AAGjG,SAAgB,YAAY,OAAoC;AAC9D,QAAO,QACL,SACE,OAAO,UAAU,YACjB,OAAQ,MAAoB,cAAc,cAC1C,UAAW,SACX,OAAQ,MAAiD,SAAS,YAClE,SAAU,MAAiD,KAC9D;;AAGH,SAAgB,aAAa,OAAqC;AAChE,KAAI,CAAC,SAAS,OAAO,UAAU,SAC7B,QAAO;CAET,MAAM,SAAS;AACf,QAAO,OAAO,OAAO,SAAS,YAAY,MAAM,QAAQ,OAAO,KAAK,IAAI,gBAAgB;;AAG1F,SAAgB,mBAAmB,QAAwC;AACzE,KAAI,CAAC,OACH,QAAO;AAGT,KAAI,YAAY,OAAO,CACrB,QAAOA,IAAE,aAAa,QAAQ,EAAE,QAAQ,WAAW,CAAC;AAKtD,KAAI,aAAa,OAAO,CACtB,QAAO;AAGT,KAAI,iBAAiB,OAAO,EAAE;AAC5B,MAAI,YAAY,UAAU,OAAO,OAAO,WAAW,WACjD,QAAO,OAAO,QAAQ;AAExB,SAAO;;AAGT,QAAO"}