{"version":3,"file":"connection-manager.mjs","names":[],"sources":["../src/connection-manager.ts"],"sourcesContent":["import IORedis, { type Redis } from 'ioredis'\nimport type { BullMQConnectionConfig } from './types'\n\nexport class ConnectionManager {\n  readonly connection: Redis\n  readonly ownsConnection: boolean\n  private isClosed: boolean\n\n  constructor(config: BullMQConnectionConfig) {\n    if (config instanceof IORedis) {\n      this.connection = config\n      this.ownsConnection = false\n    } else {\n      this.connection = new IORedis({\n        maxRetriesPerRequest: null,\n        ...config,\n      })\n      this.ownsConnection = true\n    }\n\n    this.isClosed = false\n\n    this.setupEventHandlers()\n  }\n\n  private setupEventHandlers(): void {\n    this.connection.on('error', (err: Error) => {\n      if (!this.isClosed) {\n        console.warn('[BullMQ] Connection error:', err?.message)\n      }\n    })\n\n    this.connection.on('close', () => {\n      this.isClosed = true\n      console.warn('[BullMQ] Connection closed')\n    })\n  }\n\n  async close(): Promise<void> {\n    if (this.ownsConnection && this.connection.status !== 'end') {\n      await this.connection.quit()\n    }\n  }\n}\n"],"mappings":";;;AAGA,IAAa,oBAAb,MAA+B;CAK7B,YAAY,QAAgC;AAC1C,MAAI,kBAAkB,SAAS;AAC7B,QAAK,aAAa;AAClB,QAAK,iBAAiB;SACjB;AACL,QAAK,aAAa,IAAI,QAAQ;IAC5B,sBAAsB;IACtB,GAAG;IACJ,CAAC;AACF,QAAK,iBAAiB;;AAGxB,OAAK,WAAW;AAEhB,OAAK,oBAAoB;;CAG3B,AAAQ,qBAA2B;AACjC,OAAK,WAAW,GAAG,UAAU,QAAe;AAC1C,OAAI,CAAC,KAAK,SACR,SAAQ,KAAK,8BAA8B,KAAK,QAAQ;IAE1D;AAEF,OAAK,WAAW,GAAG,eAAe;AAChC,QAAK,WAAW;AAChB,WAAQ,KAAK,6BAA6B;IAC1C;;CAGJ,MAAM,QAAuB;AAC3B,MAAI,KAAK,kBAAkB,KAAK,WAAW,WAAW,MACpD,OAAM,KAAK,WAAW,MAAM"}