import {
  useVirtualizer
} from "./chunk-YI3CNFVY.js";
import {
  JsonView
} from "./chunk-K3BQSGJQ.js";
import {
  Button,
  Input,
  LevelDot,
  Sidebar,
  cn
} from "./chunk-IASMWHZ4.js";
import {
  create
} from "./chunk-GN6RPVUP.js";
import "./chunk-PK4VJZPQ.js";
import "./chunk-H3Z5RFEW.js";
import "./chunk-6JCWOCCU.js";
import "./chunk-ZYTAZ2LT.js";
import {
  require_lucide_react
} from "./chunk-A2EHX3L2.js";
import {
  useStreamGroup
} from "./chunk-EC5G5YSN.js";
import "./chunk-7OWYCO6Z.js";
import "./chunk-ZOZQR6GQ.js";
import {
  require_jsx_runtime
} from "./chunk-OVCHON5Z.js";
import "./chunk-VZXGP5H5.js";
import {
  require_compiler_runtime
} from "./chunk-N7QBCMQ7.js";
import {
  require_react
} from "./chunk-J3YWFM6B.js";
import {
  __toESM
} from "./chunk-PR4QN5HX.js";

// node_modules/@motiadev/plugin-logs/dist/index.js
var import_lucide_react = __toESM(require_lucide_react());
var import_react = __toESM(require_react());
var import_compiler_runtime = __toESM(require_compiler_runtime());
var import_jsx_runtime = __toESM(require_jsx_runtime());
import "C:/Users/chandan2005/Desktop/chandan/Chandan-Projects/OpsGuardian/node_modules/react18-json-view/src/dark.css";
import "C:/Users/chandan2005/Desktop/chandan/Chandan-Projects/OpsGuardian/node_modules/react18-json-view/src/style.css";
var useLogsStore = create()((set) => ({
  logs: [],
  selectedLogId: void 0,
  setLogs: (logs) => set(() => {
    return { logs: [...Array.isArray(logs) ? logs : []].reverse() };
  }),
  resetLogs: () => {
    set({ logs: [] });
  },
  selectLogId: (logId) => set({ selectedLogId: logId })
}));
var streamName = "__motia.logs";
var groupId = "default";
var useLogsStream = () => {
  const $ = (0, import_compiler_runtime.c)(3);
  if ($[0] !== "07a885904ac486305cf3393f9436986fc94bf9cf48b0fc1eba70eadcdf49ee10") {
    for (let $i = 0; $i < 3; $i += 1) $[$i] = /* @__PURE__ */ Symbol.for("react.memo_cache_sentinel");
    $[0] = "07a885904ac486305cf3393f9436986fc94bf9cf48b0fc1eba70eadcdf49ee10";
  }
  const setData = useLogsStore(_temp);
  let t0;
  if ($[1] !== setData) {
    t0 = {
      streamName,
      groupId,
      setData
    };
    $[1] = setData;
    $[2] = t0;
  } else t0 = $[2];
  useStreamGroup(t0);
};
function _temp(state) {
  return state.setLogs;
}
var formatTimestamp = (time) => {
  const date = new Date(Number(time));
  return `${date.toLocaleDateString("en-US", {
    year: void 0,
    month: "short",
    day: "2-digit"
  })}, ${date.toLocaleTimeString("en-US", {
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
    hourCycle: "h24"
  })}.${date.getMilliseconds().toString().padStart(3, "0")}`;
};
var defaultProps = [
  "id",
  "msg",
  "time",
  "level",
  "step",
  "flows",
  "traceId"
];
var LogDetail = ({ log, onClose }) => {
  const [hasOtherProps, setHasOtherProps] = (0, import_react.useState)(false);
  const otherPropsObject = (0, import_react.useMemo)(() => {
    if (!log) return null;
    const otherProps = Object.keys(log ?? {}).filter((key) => !defaultProps.includes(key));
    setHasOtherProps(otherProps.length > 0);
    return otherProps.reduce((acc, key_0) => {
      acc[key_0] = log[key_0];
      return acc;
    }, {});
  }, [log]);
  if (!log) return null;
  return (0, import_jsx_runtime.jsx)(Sidebar, {
    onClose,
    title: "Logs Details",
    subtitle: "Details including custom properties",
    actions: [{
      icon: (0, import_jsx_runtime.jsx)(import_lucide_react.X, {}),
      onClick: onClose,
      label: "Close"
    }],
    details: [
      {
        label: "Level",
        value: (0, import_jsx_runtime.jsxs)("div", {
          className: "flex items-center gap-2",
          children: [(0, import_jsx_runtime.jsx)(LevelDot, { level: log.level }), (0, import_jsx_runtime.jsx)("div", {
            className: "capitalize",
            children: log.level
          })]
        })
      },
      {
        label: "Time",
        value: formatTimestamp(log.time)
      },
      {
        label: "Step",
        value: log.step
      },
      {
        label: "Flows",
        value: log.flows.join(", ")
      },
      {
        label: "Trace ID",
        value: log.traceId
      }
    ],
    children: hasOtherProps && (0, import_jsx_runtime.jsx)(JsonView, {
      src: otherPropsObject,
      theme: "default",
      enableClipboard: true
    })
  });
};
var ROW_HEIGHT = 40;
var LogsPage = () => {
  useLogsStream();
  const logs = useLogsStore((state) => state.logs);
  const resetLogs = useLogsStore((state_0) => state_0.resetLogs);
  const selectedLogId = useLogsStore((state_1) => state_1.selectedLogId);
  const selectLogId = useLogsStore((state_2) => state_2.selectLogId);
  const selectedLog = (0, import_react.useMemo)(() => selectedLogId ? logs.find((log) => log.id === selectedLogId) : void 0, [logs, selectedLogId]);
  const [search, setSearch] = (0, import_react.useState)("");
  const filteredLogs = (0, import_react.useMemo)(() => {
    return logs.filter((log_0) => {
      return String(log_0.msg || "").toLowerCase().includes(search.toLowerCase()) || String(log_0.traceId || "").toLowerCase().includes(search.toLowerCase()) || String(log_0.step || "").toLowerCase().includes(search.toLowerCase());
    });
  }, [logs, search]);
  const scrollContainerRef = (0, import_react.useRef)(null);
  const virtualizer = useVirtualizer({
    count: filteredLogs.length,
    getScrollElement: () => scrollContainerRef.current,
    estimateSize: () => ROW_HEIGHT,
    overscan: 5
  });
  const virtualItems = virtualizer.getVirtualItems();
  return (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [(0, import_jsx_runtime.jsxs)("div", {
    className: "grid grid-rows-[auto_1fr] h-full",
    "data-testid": "logs-container",
    children: [(0, import_jsx_runtime.jsxs)("div", {
      className: "flex p-2 border-b gap-2",
      "data-testid": "logs-search-container",
      children: [(0, import_jsx_runtime.jsxs)("div", {
        className: "flex-1 relative",
        children: [
          (0, import_jsx_runtime.jsx)(Input, {
            variant: "shade",
            value: search,
            onChange: (e) => setSearch(e.target.value),
            className: "px-9! font-medium",
            placeholder: "Search by Trace ID or Message"
          }),
          (0, import_jsx_runtime.jsx)(import_lucide_react.Search, { className: "absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50" }),
          (0, import_jsx_runtime.jsx)(import_lucide_react.X, {
            className: "cursor-pointer absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50 hover:text-muted-foreground",
            onClick: () => setSearch("")
          })
        ]
      }), (0, import_jsx_runtime.jsxs)(Button, {
        variant: "default",
        onClick: resetLogs,
        className: "h-[34px]",
        children: [(0, import_jsx_runtime.jsx)(import_lucide_react.Trash, {}), " Clear"]
      })]
    }), (0, import_jsx_runtime.jsx)("div", {
      ref: scrollContainerRef,
      className: "overflow-auto h-full",
      children: (0, import_jsx_runtime.jsx)("div", {
        className: "relative w-full",
        style: { height: virtualizer.getTotalSize() },
        children: virtualItems.map((virtualRow) => {
          const log_1 = filteredLogs[virtualRow.index];
          if (!log_1) return null;
          const index = virtualRow.index;
          return (0, import_jsx_runtime.jsxs)("div", {
            "data-testid": "log-row",
            "data-index": virtualRow.index,
            ref: virtualizer.measureElement,
            role: "row",
            tabIndex: 0,
            className: cn("absolute left-0 w-full flex items-center font-mono font-semibold cursor-pointer text-sm", {
              "bg-muted-foreground/10 hover:bg-muted-foreground/20": selectedLogId === log_1.id,
              "hover:bg-muted-foreground/10": selectedLogId !== log_1.id
            }),
            style: {
              height: ROW_HEIGHT,
              transform: `translateY(${virtualRow.start}px)`
            },
            onClick: () => selectLogId(log_1.id),
            onKeyDown: (e_0) => {
              if (e_0.key === "Enter" || e_0.key === " ") selectLogId(log_1.id);
            },
            children: [
              (0, import_jsx_runtime.jsxs)("div", {
                "data-testid": `time-${index}`,
                role: "cell",
                className: "whitespace-nowrap flex items-center gap-2 text-muted-foreground p-2 shrink-0",
                children: [(0, import_jsx_runtime.jsx)(LevelDot, { level: log_1.level }), formatTimestamp(log_1.time)]
              }),
              (0, import_jsx_runtime.jsxs)("div", {
                className: "flex items-center shrink-0",
                children: [(0, import_jsx_runtime.jsx)("span", {
                  "data-testid": `trace-${log_1.traceId}`,
                  className: "whitespace-nowrap text-muted-foreground p-2 font-mono font-semibold text-sm",
                  children: log_1.traceId
                }), (0, import_jsx_runtime.jsx)("button", {
                  type: "button",
                  "data-testid": `trace-filter-${log_1.traceId}`,
                  "aria-label": `Filter by trace ${log_1.traceId}`,
                  title: `Filter by trace ${log_1.traceId}`,
                  className: "p-1 rounded hover:bg-muted-foreground/20 text-muted-foreground hover:text-primary transition-colors cursor-pointer",
                  onClick: (e_1) => {
                    e_1.stopPropagation();
                    setSearch(log_1.traceId);
                  },
                  children: (0, import_jsx_runtime.jsx)(import_lucide_react.Filter, { className: "w-3 h-3" })
                })]
              }),
              (0, import_jsx_runtime.jsx)("div", {
                "data-testid": `step-${index}`,
                role: "cell",
                title: log_1.step,
                className: "whitespace-nowrap p-2 shrink-0",
                children: log_1.step
              }),
              (0, import_jsx_runtime.jsx)("div", {
                "data-testid": `msg-${index}`,
                role: "cell",
                title: log_1.msg,
                className: "whitespace-nowrap max-w-[500px] truncate p-2 flex-1",
                children: log_1.msg
              })
            ]
          }, log_1.id);
        })
      })
    })]
  }), (0, import_jsx_runtime.jsx)(LogDetail, {
    log: selectedLog,
    onClose: () => selectLogId(void 0)
  })] });
};
export {
  LogsPage
};
//# sourceMappingURL=@motiadev_plugin-logs.js.map
