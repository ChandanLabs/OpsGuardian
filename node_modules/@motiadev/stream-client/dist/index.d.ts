//#region src/socket-adapter.d.ts
interface SocketAdapter {
  connect(): void;
  close(): void;
  send(message: string): void;
  isOpen(): boolean;
  onMessage(callback: (message: string) => void): void;
  onOpen(callback: () => void): void;
  onClose(callback: () => void): void;
}
//#endregion
//#region src/adapter-factory.d.ts
type SocketAdapterFactory = () => SocketAdapter;
//#endregion
//#region src/stream.types.d.ts
type BaseMessage = {
  streamName: string;
  groupId: string;
  id?: string;
  timestamp: number;
};
type JoinMessage = Omit<BaseMessage, 'timestamp'> & {
  subscriptionId: string;
};
type CustomEvent = {
  type: string;
  data: any;
};
type StreamEvent<TData extends {
  id: string;
}> = {
  type: 'create';
  data: TData;
} | {
  type: 'update';
  data: TData;
} | {
  type: 'delete';
  data: TData;
} | {
  type: 'event';
  event: CustomEvent;
};
type ItemStreamEvent<TData extends {
  id: string;
}> = StreamEvent<TData> | {
  type: 'sync';
  data: TData;
};
type GroupStreamEvent<TData extends {
  id: string;
}> = StreamEvent<TData> | {
  type: 'sync';
  data: TData[];
};
type ItemEventMessage<TData extends {
  id: string;
}> = BaseMessage & {
  event: ItemStreamEvent<TData>;
};
type GroupEventMessage<TData extends {
  id: string;
}> = BaseMessage & {
  event: GroupStreamEvent<TData>;
};
type Message = {
  type: 'join' | 'leave';
  data: JoinMessage;
};
type Listener<TData> = (state: TData | null) => void;
type CustomEventListener<TData> = (event: TData) => void;
//#endregion
//#region src/stream-subscription.d.ts
type CustomEventListener$1 = (event: any) => void;
declare abstract class StreamSubscription<TData = unknown, TEventData = unknown> {
  private customEventListeners;
  private closeListeners;
  private onChangeListeners;
  private state;
  readonly sub: JoinMessage;
  constructor(sub: JoinMessage, state: TData);
  abstract listener(message: TEventData): void;
  protected onEventReceived(event: CustomEvent): void;
  /**
   * Add a custom event listener. This listener will be called whenever the custom event is received.
   */
  onEvent(type: string, listener: CustomEventListener$1): void;
  /**
   * Remove a custom event listener.
   */
  offEvent(type: string, listener: CustomEventListener$1): void;
  onClose(listener: () => void): void;
  close(): void;
  /**
   * Add a change listener. This listener will be called whenever the state of the group changes.
   */
  addChangeListener(listener: Listener<TData>): void;
  /**
   * Remove a change listener.
   */
  removeChangeListener(listener: Listener<TData>): void;
  /**
   * Get the current state of the group.
   */
  getState(): TData;
  protected setState(state: TData): void;
}
//#endregion
//#region src/stream-group.d.ts
declare class StreamGroupSubscription<TData extends {
  id: string;
}> extends StreamSubscription<TData[], GroupEventMessage<TData>> {
  private sortKey?;
  private lastTimestamp;
  private lastTimestampMap;
  constructor(sub: JoinMessage, sortKey?: keyof TData | undefined);
  private sort;
  protected setState(state: TData[]): void;
  listener(message: GroupEventMessage<TData>): void;
}
//#endregion
//#region src/stream-item.d.ts
declare class StreamItemSubscription<TData extends {
  id: string;
}> extends StreamSubscription<TData | null, ItemEventMessage<TData>> {
  private lastEventTimestamp;
  constructor(sub: JoinMessage);
  listener(message: ItemEventMessage<TData>): void;
}
//#endregion
//#region src/stream.d.ts
declare class Stream {
  private adapterFactory;
  private ws;
  private listeners;
  constructor(adapterFactory: SocketAdapterFactory);
  createSocket(): SocketAdapter;
  /**
   * Subscribe to an item in a stream.
   *
   * @argument streamName - The name of the stream to subscribe to.
   * @argument groupId - The id of the group to subscribe to.
   * @argument id - The id of the item to subscribe to.
   */
  subscribeItem<TData extends {
    id: string;
  }>(streamName: string, groupId: string, id: string): StreamItemSubscription<TData>;
  /**
   * Subscribe to a group in a stream.
   *
   * @argument streamName - The name of the stream to subscribe to.
   * @argument groupId - The id of the group to subscribe to.
   */
  subscribeGroup<TData extends {
    id: string;
  }>(streamName: string, groupId: string, sortKey?: keyof TData): StreamGroupSubscription<TData>;
  close(): void;
  private onSocketClose;
  private onSocketOpen;
  messageListener(event: string): void;
  private subscribe;
  private join;
  private leave;
  private roomName;
}
//#endregion
export { BaseMessage, CustomEvent, CustomEventListener, GroupEventMessage, GroupStreamEvent, ItemEventMessage, ItemStreamEvent, JoinMessage, Listener, Message, type SocketAdapter, type SocketAdapterFactory, Stream, StreamEvent, StreamGroupSubscription, StreamItemSubscription, StreamSubscription };