{"version":3,"file":"plugin.js","names":["ApiRouteConfig","ApiRouteMethod","JsonSchema","LockedData","QueryParam","Step","StreamAdapter","ApiEndpoint","id","method","path","description","queryParams","responseSchema","bodySchema","flows","mapEndpoint","step","filePath","config","EndpointsStream","constructor","lockedData","get","_groupId","Promise","endpoint","apiSteps","find","delete","set","_","__","data","getGroup","map","isApiStep","MotiaPlugin","MotiaPluginContext","Step","EndpointsStream","mapEndpoint","plugin","lockedData","stream","createStream","filePath","hidden","config","name","baseConfig","storageType","factory","schema","apiStepCreated","step","set","id","method","path","description","queryParams","apiStepUpdated","apiStepRemoved","delete","onStep","workbench","packageName","cssImports","label","position","componentName","labelIcon","plugin"],"sources":["../src/api/endpoints-stream.ts","../src/api/index.ts","../src/plugin.ts"],"sourcesContent":["import {\n  type ApiRouteConfig,\n  type ApiRouteMethod,\n  type JsonSchema,\n  type LockedData,\n  type QueryParam,\n  type Step,\n  StreamAdapter,\n} from '@motiadev/core'\n\ntype ApiEndpoint = {\n  id: string\n  method: ApiRouteMethod\n  path: string\n  description?: string\n  queryParams?: QueryParam[]\n  responseSchema?: JsonSchema\n  bodySchema?: JsonSchema\n  flows?: string[]\n}\n\nexport const mapEndpoint = (step: Step<ApiRouteConfig>): ApiEndpoint => {\n  return {\n    id: step.filePath,\n    method: step.config.method,\n    path: step.config.path,\n    description: step.config.description,\n    queryParams: step.config.queryParams,\n    responseSchema: step.config.responseSchema as never as JsonSchema,\n    bodySchema: step.config.bodySchema as never as JsonSchema,\n    flows: step.config.flows,\n  }\n}\n\nexport class EndpointsStream extends StreamAdapter<ApiEndpoint> {\n  constructor(private readonly lockedData: LockedData) {\n    super('__motia.api-endpoints')\n  }\n\n  async get(_groupId: string, id: string): Promise<ApiEndpoint | null> {\n    const endpoint = this.lockedData.apiSteps().find((step) => step.filePath === id)\n    return endpoint ? mapEndpoint(endpoint) : null\n  }\n\n  async delete(id: string): Promise<ApiEndpoint> {\n    return { id } as never\n  }\n\n  async set(_: string, __: string, data: ApiEndpoint): Promise<ApiEndpoint> {\n    return data\n  }\n\n  async getGroup(): Promise<ApiEndpoint[]> {\n    return this.lockedData.apiSteps().map(mapEndpoint)\n  }\n}\n","import { isApiStep, type MotiaPlugin, type MotiaPluginContext, type Step } from '@motiadev/core'\nimport { EndpointsStream, mapEndpoint } from './endpoints-stream'\n\nexport function plugin({ lockedData }: MotiaPluginContext): MotiaPlugin {\n  const stream = lockedData.createStream({\n    filePath: '__motia.api-endpoints.ts',\n    hidden: true,\n    config: {\n      name: '__motia.api-endpoints',\n      baseConfig: { storageType: 'custom', factory: () => new EndpointsStream(lockedData) },\n      schema: null as never,\n    },\n  })()\n\n  const apiStepCreated = (step: Step) => {\n    if (isApiStep(step)) {\n      stream.set('default', step.filePath, {\n        id: step.filePath,\n        method: step.config.method,\n        path: step.config.path,\n        description: step.config.description,\n        queryParams: step.config.queryParams,\n      })\n    }\n  }\n\n  const apiStepUpdated = (step: Step) => {\n    if (isApiStep(step)) {\n      stream.set('default', step.filePath, mapEndpoint(step))\n    }\n  }\n\n  const apiStepRemoved = (step: Step) => {\n    if (isApiStep(step)) {\n      stream.delete('default', step.filePath)\n    }\n  }\n\n  lockedData.onStep('step-created', apiStepCreated)\n  lockedData.onStep('step-updated', apiStepUpdated)\n  lockedData.onStep('step-removed', apiStepRemoved)\n\n  return {\n    workbench: [\n      {\n        packageName: '@motiadev/plugin-endpoint',\n        cssImports: ['@motiadev/plugin-endpoint/dist/styles.css'],\n        label: 'Endpoints',\n        position: 'top',\n        componentName: 'EndpointsPage',\n        labelIcon: 'link-2',\n      },\n    ],\n  }\n}\n","import { plugin } from './api'\n\nexport default plugin\n"],"mappings":";;;AAqBA,MAAagB,eAAeC,SAA4C;AACtE,QAAO;EACLT,IAAIS,KAAKC;EACTT,QAAQQ,KAAKE,OAAOV;EACpBC,MAAMO,KAAKE,OAAOT;EAClBC,aAAaM,KAAKE,OAAOR;EACzBC,aAAaK,KAAKE,OAAOP;EACzBC,gBAAgBI,KAAKE,OAAON;EAC5BC,YAAYG,KAAKE,OAAOL;EACxBC,OAAOE,KAAKE,OAAOJ;EACpB;;AAGH,IAAaK,kBAAb,cAAqCd,cAA2B;CAC9De,YAAY,AAAiBC,YAAwB;AACnD,QAAM,wBAAwB;EADHA;;CAI7B,MAAMC,IAAIC,UAAkBhB,IAAyC;EACnE,MAAMkB,WAAW,KAAKJ,WAAWK,UAAU,CAACC,MAAMX,SAASA,KAAKC,aAAaV,GAAG;AAChF,SAAOkB,WAAWV,YAAYU,SAAS,GAAG;;CAG5C,MAAMG,OAAOrB,IAAkC;AAC7C,SAAO,EAAEA,IAAI;;CAGf,MAAMsB,IAAIC,GAAWC,IAAYC,MAAyC;AACxE,SAAOA;;CAGT,MAAMC,WAAmC;AACvC,SAAO,KAAKZ,WAAWK,UAAU,CAACQ,IAAInB,YAAY;;;;;;AClDtD,SAAgB0B,OAAO,EAAEC,cAA+C;CACtE,MAAMC,SAASD,WAAWE,aAAa;EACrCC,UAAU;EACVC,QAAQ;EACRC,QAAQ;GACNC,MAAM;GACNC,YAAY;IAAEC,aAAa;IAAUC,eAAe,IAAIZ,gBAAgBG,WAAU;IAAG;GACrFU,QAAQ;GACV;EACD,CAAC,EAAE;CAEJ,MAAMC,kBAAkBC,SAAe;AACrC,MAAInB,UAAUmB,KAAK,CACjBX,QAAOY,IAAI,WAAWD,KAAKT,UAAU;GACnCW,IAAIF,KAAKT;GACTY,QAAQH,KAAKP,OAAOU;GACpBC,MAAMJ,KAAKP,OAAOW;GAClBC,aAAaL,KAAKP,OAAOY;GACzBC,aAAaN,KAAKP,OAAOa;GAC1B,CAAC;;CAIN,MAAMC,kBAAkBP,SAAe;AACrC,MAAInB,UAAUmB,KAAK,CACjBX,QAAOY,IAAI,WAAWD,KAAKT,UAAUL,YAAYc,KAAK,CAAC;;CAI3D,MAAMQ,kBAAkBR,SAAe;AACrC,MAAInB,UAAUmB,KAAK,CACjBX,QAAOoB,OAAO,WAAWT,KAAKT,SAAS;;AAI3CH,YAAWsB,OAAO,gBAAgBX,eAAe;AACjDX,YAAWsB,OAAO,gBAAgBH,eAAe;AACjDnB,YAAWsB,OAAO,gBAAgBF,eAAe;AAEjD,QAAO,EACLG,WAAW,CACT;EACEC,aAAa;EACbC,YAAY,CAAC,4CAA4C;EACzDC,OAAO;EACPC,UAAU;EACVC,eAAe;EACfC,WAAW;EACZ,CAAA,EAEJ;;;;;ACnDH,qBAAeC"}