{"version":3,"file":"build-printer.mjs","names":[],"sources":["../../../../src/cloud/new-deployment/listeners/build-printer.ts"],"sourcesContent":["import type { Step, Stream } from '@motiadev/core'\nimport { Printer } from '@motiadev/core'\nimport pc from 'picocolors'\nimport { CLIOutputManager } from '../../cli-output-manager'\nimport { prettyBytes } from '../utils/pretty-bytes'\n\nconst building = pc.yellow('➜ [BUILDING]')\nconst built = pc.green('✓ [BUILT]')\nconst failed = pc.red('✘ [FAILED]')\nconst skipped = pc.gray('- [SKIPPED]')\n\nconst baseTag = (tag: string) => pc.bold(pc.magenta(tag))\nconst streamTag = baseTag('Stream')\nconst stepTag = baseTag('Step')\nconst routerTag = baseTag('Router')\n\nexport class BuildPrinter {\n  private readonly printer = new Printer(process.cwd())\n  private readonly output = new CLIOutputManager()\n\n  getLanguage(language: string) {\n    if (language === 'python') {\n      return pc.bold(pc.blue('Python'))\n    } else if (language === 'node') {\n      return pc.bold(pc.green('Node'))\n    } else if (language === 'ruby') {\n      return pc.bold(pc.red('Ruby'))\n    }\n\n    return pc.bold(pc.gray('Unknown'))\n  }\n\n  getStepLanguage(step: Step) {\n    if (step.filePath.endsWith('.py')) {\n      return this.getLanguage('python')\n    } else if (step.filePath.endsWith('.js') || step.filePath.endsWith('.ts')) {\n      return this.getLanguage('node')\n    } else if (step.filePath.endsWith('.rb')) {\n      return this.getLanguage('ruby')\n    }\n\n    return this.getLanguage('unknown')\n  }\n\n  printStepBuilding(step: Step, progressMessage?: string) {\n    const stepLanguage = this.getStepLanguage(step)\n    const stepType = this.printer.getStepType(step)\n    const stepPath = this.printer.getStepPath(step)\n\n    this.output.log(step.filePath, (message) => {\n      message.append(`${building} ${stepTag} ${stepLanguage} ${stepType} ${stepPath}`)\n\n      if (progressMessage) {\n        message.append(pc.yellow(progressMessage))\n      }\n    })\n  }\n\n  printStepBuilt(step: Step, size: number) {\n    const stepLanguage = this.getStepLanguage(step)\n    const stepType = this.printer.getStepType(step)\n    const stepPath = this.printer.getStepPath(step)\n\n    this.output.log(step.filePath, (message) =>\n      message\n        .append(`${built} ${stepTag} ${stepLanguage} ${stepType} ${stepPath}`)\n        .append(`${prettyBytes(size)}`, 'gray'),\n    )\n  }\n\n  printApiRouterBuilding(language: string) {\n    const fileName = `router-${language}.zip`\n    const coloredFileName = pc.bold(pc.cyan(fileName))\n\n    this.output.log(fileName, (message) =>\n      message //\n        .append(routerTag)\n        .append(building)\n        .append(this.getLanguage(language))\n        .append(coloredFileName),\n    )\n  }\n\n  printApiRouterBuilt(language: string, size: number) {\n    const fileName = `router-${language}.zip`\n    const coloredFileName = pc.bold(pc.cyan(fileName))\n\n    this.output.log(fileName, (message) =>\n      message\n        .append(built)\n        .append(routerTag)\n        .append(this.getLanguage(language))\n        .append(coloredFileName)\n        .append(prettyBytes(size), 'gray'),\n    )\n  }\n\n  printStepFailed(step: Step, error: Error) {\n    const stepLanguage = this.getStepLanguage(step)\n    const stepType = this.printer.getStepType(step)\n    const stepPath = this.printer.getStepPath(step)\n\n    this.output.log(step.filePath, (message) =>\n      message.append(`${failed} ${stepTag} ${stepLanguage} ${stepType} ${stepPath}`).append(error.message, 'red'),\n    )\n  }\n\n  printStepSkipped(step: Step, reason: string) {\n    const stepLanguage = this.getStepLanguage(step)\n    const stepType = this.printer.getStepType(step)\n    const stepPath = this.printer.getStepPath(step)\n\n    this.output.log(step.filePath, (message) =>\n      message.append(`${skipped} ${stepTag} ${stepLanguage} ${stepType} ${stepPath}`).append(reason, 'yellow'),\n    )\n  }\n\n  printStreamCreated(stream: Stream) {\n    const streamPath = this.getStreamPath(stream)\n    const streamName = pc.gray(`[${stream.config.name}]`)\n\n    this.output.log(stream.filePath, (message) => message.append(`${built} ${streamTag} ${streamName} ${streamPath}`))\n  }\n\n  getStreamPath(stream: Stream) {\n    return pc.bold(pc.cyan(this.printer.getRelativePath(stream.filePath)))\n  }\n}\n"],"mappings":"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"}