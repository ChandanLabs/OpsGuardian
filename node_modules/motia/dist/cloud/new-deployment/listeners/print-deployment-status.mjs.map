{"version":3,"file":"print-deployment-status.mjs","names":[],"sources":["../../../../src/cloud/new-deployment/listeners/print-deployment-status.ts"],"sourcesContent":["import pc from 'picocolors'\nimport type { Message } from '../../cli-output-manager'\nimport type { CliContext } from '../../config-utils'\nimport type { DeployData, DeployStatus } from './listener.types'\n\ntype ColorFn = (text: string) => string\n\nlet spinnerIndex = 0\n\nexport const getStatusColor = (status: DeployStatus): ColorFn => {\n  switch (status) {\n    case 'completed':\n      return pc.green\n    case 'failed':\n      return pc.red\n    case 'progress':\n      return pc.yellow\n    case 'pending':\n      return pc.gray\n    default:\n      return pc.gray\n  }\n}\n\nexport const printDeploymentStatus = (data: DeployData, context: CliContext) => {\n  const spinners = ['⠋', '⠙', '⠹', '⠸', '⠼', '⠴', '⠦', '⠧', '⠇', '⠏']\n\n  const getSpinner = () => {\n    const spinner = spinners[spinnerIndex]\n    spinnerIndex = (spinnerIndex + 1) % spinners.length\n    return pc.gray(spinner)\n  }\n\n  context.log('deployment-status-blank-1', (message: Message) => message.append(''))\n\n  const generateEmitList = (emits: string[] = []) => {\n    return emits.map((e) => pc.white(`⌁ ${e}`)).join(pc.white(', '))\n  }\n\n  const getStatus = (status: DeployStatus) => {\n    return status === 'failed' ? pc.red('✘') : status === 'completed' ? pc.green('✓') : getSpinner()\n  }\n\n  const lambda = (stepName: string, color: ColorFn) => color(`λ ${stepName}`)\n  const eventStatus = data.events.reduce((acc, event) => {\n    return acc === 'failed' ? 'failed' : acc === 'completed' ? event.status : acc\n  }, 'completed' as DeployStatus)\n  const cronStatus = data.cron.reduce((acc, cron) => {\n    return acc === 'failed' ? 'failed' : acc === 'completed' ? cron.status : acc\n  }, 'completed' as DeployStatus)\n  const apigwStatus = data.endpoints.reduce((acc, endpoint) => {\n    return acc === 'failed' ? 'failed' : acc === 'completed' ? endpoint.status : acc\n  }, 'completed' as DeployStatus)\n\n  context.log('deployment-status-step-handler', (message: Message) =>\n    message.append(`[${getStatus(eventStatus)}]   [λ Step Handler]`),\n  )\n\n  // Display event listeners\n  data.events.forEach((event) => {\n    const color = getStatusColor(event.status)\n    const status = getStatus(event.status)\n    const topicList = generateEmitList(event.topics)\n\n    context.log(`event-${event.stepName}`, (message: Message) => {\n      message.append(`[${status}]    ↳ [${topicList}] → [≡ ${color(event.queue)}] → [${lambda(event.stepName, color)}]`)\n    })\n  })\n\n  context.log('deployment-status-blank-2', (message: Message) => message.append(''))\n\n  // Display API Gateway\n  context.log('deployment-status-api-gateway', (message: Message) =>\n    message.append(`[${getStatus(apigwStatus)}]   [⛩ API Gateway]`),\n  )\n\n  data.endpoints.forEach((endpoint) => {\n    const color = getStatusColor(endpoint.status)\n    const status = getStatus(endpoint.status)\n    const emitsList = generateEmitList(endpoint.emits)\n\n    context.log(`endpoint-${endpoint.stepName}`, (message: Message) => {\n      message.append(\n        `[${status}]    ↳ /${endpoint.method} ${endpoint.path} → [${lambda(endpoint.stepName, color)}] → [${emitsList}]`,\n      )\n    })\n  })\n  context.log('deployment-status-blank-3', (message: Message) => message.append(''))\n\n  // Display Cron jobs\n  context.log('deployment-status-cron', (message: Message) => message.append(`[${getStatus(cronStatus)}]   [↺ Cron]`))\n\n  if (data.cron.length > 0) {\n    data.cron.forEach((cronJob) => {\n      const color = getStatusColor(cronJob.status)\n      const status = getStatus(cronJob.status)\n      const emitsList = generateEmitList(cronJob.emits)\n\n      context.log(`cron-${cronJob.stepName}`, (message: Message) => {\n        message.append(`[${status}]    ↳ ${cronJob.cron} → [${lambda(cronJob.stepName, color)}] → [${emitsList}]`)\n      })\n    })\n  } else {\n    context.log('deployment-status-cron-no-jobs', (message: Message) =>\n      message.append(`[${pc.green('✓')}]    ↳ No cron jobs configured`),\n    )\n  }\n\n  // Display Legend\n  context.log('deployment-status-legent', (message: Message) => message.append('\\nLegend'))\n  context.log('deployment-status-legent-queue', (message: Message) => message.append('↳ ≡ Queue'))\n  context.log('deployment-status-legent-api-gateway', (message: Message) => message.append('↳ ⛩ API Gateway'))\n  context.log('deployment-status-legent-topic', (message: Message) => message.append('↳ ⌁ Topic'))\n  context.log('deployment-status-legent-function-handler', (message: Message) => message.append('↳ λ Step Handler'))\n  context.log('deployment-status-legent-cron-job', (message: Message) => message.append('↳ ↺ Cron Job'))\n}\n"],"mappings":"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"}