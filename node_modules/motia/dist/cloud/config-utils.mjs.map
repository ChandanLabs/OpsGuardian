{"version":3,"file":"config-utils.mjs","names":["commandParts: string[]","handler","error: any"],"sources":["../../src/cloud/config-utils.ts"],"sourcesContent":["import { flush } from '@amplitude/analytics-node'\nimport { logCliError } from '../utils/analytics'\nimport { CLIOutputManager, type Message } from './cli-output-manager'\n\nexport type { Message }\n\nconst getCommandName = (): string => {\n  const args = process.argv.slice(2)\n  const commandParts: string[] = []\n\n  for (let i = 0; i < args.length && i < 3; i++) {\n    const arg = args[i]\n    if (!arg.startsWith('-') && !arg.startsWith('--')) {\n      commandParts.push(arg)\n    } else {\n      break\n    }\n  }\n\n  return commandParts.join(' ') || 'unknown'\n}\n\nexport class CliContext {\n  private readonly output = new CLIOutputManager()\n\n  log(id: string, callback: (message: Message) => void) {\n    this.output.log(id, callback)\n  }\n\n  exitWithError(msg: string, error?: unknown): never {\n    this.output.log('error', (message) => {\n      message.tag('failed').append(msg)\n\n      if (error) {\n        message.box([error instanceof Error ? error.message : 'Unknown error'], 'red')\n      }\n    })\n    process.exit(1)\n  }\n\n  exit(code: number): never {\n    process.exit(code)\n  }\n}\n\nexport type CliHandler = <TArgs extends Record<string, any>>(args: TArgs, context: CliContext) => Promise<void>\n\nexport function handler(handler: CliHandler): (args: Record<string, any>) => Promise<void> {\n  return async (args: Record<string, unknown>) => {\n    const context = new CliContext()\n    const commandName = getCommandName()\n\n    try {\n      await handler(args, context)\n    } catch (error: any) {\n      logCliError(commandName, error)\n      await flush().promise.catch(() => {\n        // Silently fail\n      })\n      if (error instanceof Error) {\n        error.message && context.log('error', (message) => message.tag('failed').append(error.message))\n        context.exit(1)\n      } else {\n        context.exitWithError('An error occurred', error)\n      }\n    }\n  }\n}\n"],"mappings":";;;;;AAMA,MAAM,uBAA+B;CACnC,MAAM,OAAO,QAAQ,KAAK,MAAM,EAAE;CAClC,MAAMA,eAAyB,EAAE;AAEjC,MAAK,IAAI,IAAI,GAAG,IAAI,KAAK,UAAU,IAAI,GAAG,KAAK;EAC7C,MAAM,MAAM,KAAK;AACjB,MAAI,CAAC,IAAI,WAAW,IAAI,IAAI,CAAC,IAAI,WAAW,KAAK,CAC/C,cAAa,KAAK,IAAI;MAEtB;;AAIJ,QAAO,aAAa,KAAK,IAAI,IAAI;;AAGnC,IAAa,aAAb,MAAwB;;gBACI,IAAI,kBAAkB;;CAEhD,IAAI,IAAY,UAAsC;AACpD,OAAK,OAAO,IAAI,IAAI,SAAS;;CAG/B,cAAc,KAAa,OAAwB;AACjD,OAAK,OAAO,IAAI,UAAU,YAAY;AACpC,WAAQ,IAAI,SAAS,CAAC,OAAO,IAAI;AAEjC,OAAI,MACF,SAAQ,IAAI,CAAC,iBAAiB,QAAQ,MAAM,UAAU,gBAAgB,EAAE,MAAM;IAEhF;AACF,UAAQ,KAAK,EAAE;;CAGjB,KAAK,MAAqB;AACxB,UAAQ,KAAK,KAAK;;;AAMtB,SAAgB,QAAQ,WAAmE;AACzF,QAAO,OAAO,SAAkC;EAC9C,MAAM,UAAU,IAAI,YAAY;EAChC,MAAM,cAAc,gBAAgB;AAEpC,MAAI;AACF,SAAMC,UAAQ,MAAM,QAAQ;WACrBC,OAAY;AACnB,eAAY,aAAa,MAAM;AAC/B,SAAM,OAAO,CAAC,QAAQ,YAAY,GAEhC;AACF,OAAI,iBAAiB,OAAO;AAC1B,UAAM,WAAW,QAAQ,IAAI,UAAU,YAAY,QAAQ,IAAI,SAAS,CAAC,OAAO,MAAM,QAAQ,CAAC;AAC/F,YAAQ,KAAK,EAAE;SAEf,SAAQ,cAAc,qBAAqB,MAAM"}