{"version":3,"file":"build-validation.mjs","names":["validationPipeline: Validator[]"],"sources":["../../../src/cloud/build/build-validation.ts"],"sourcesContent":["import type { BuildListener } from '../new-deployment/listeners/listener.types'\nimport type { Builder } from './builder'\nimport { apiEndpointsValidator } from './validations/api-endpoints.validator'\nimport { cronExpressionsValidator } from './validations/cron-expressions.validator'\nimport { duplicateStepNamesValidator } from './validations/duplicate-step-names.validator'\nimport { infrastructureConfigsValidator } from './validations/infrastructure-configs.validator'\nimport { routerBundleSizesValidator } from './validations/router-bundle-sizes.validator'\nimport { stepBundleSizesValidator } from './validations/step-bundle-sizes.validator'\nimport { stepNameLengthsValidator } from './validations/step-name-lengths.validator'\nimport type { ValidationResult, Validator } from './validations/types'\n\nexport const buildValidation = (builder: Builder, listener: BuildListener) => {\n  const { errors, warnings } = validateStepsConfig(builder)\n\n  if (warnings.length > 0) {\n    warnings.forEach((warning) => listener.onBuildWarning(warning))\n  }\n\n  if (errors.length > 0) {\n    listener.onBuildErrors(errors)\n    return false\n  }\n\n  return true\n}\n\nconst validationPipeline: Validator[] = [\n  duplicateStepNamesValidator,\n  stepBundleSizesValidator,\n  cronExpressionsValidator,\n  apiEndpointsValidator,\n  stepNameLengthsValidator,\n  infrastructureConfigsValidator,\n  routerBundleSizesValidator,\n]\n\nconst runValidationPipeline = (builder: Builder, validators: Validator[]): ValidationResult => {\n  return validators.reduce<ValidationResult>(\n    (acc, validator) => {\n      const result = validator(builder)\n      return {\n        errors: [...acc.errors, ...result.errors],\n        warnings: [...acc.warnings, ...result.warnings],\n      }\n    },\n    { errors: [], warnings: [] },\n  )\n}\n\nexport const validateStepsConfig = (builder: Builder): ValidationResult => {\n  return runValidationPipeline(builder, validationPipeline)\n}\n"],"mappings":";;;;;;;;;AAWA,MAAa,mBAAmB,SAAkB,aAA4B;CAC5E,MAAM,EAAE,QAAQ,aAAa,oBAAoB,QAAQ;AAEzD,KAAI,SAAS,SAAS,EACpB,UAAS,SAAS,YAAY,SAAS,eAAe,QAAQ,CAAC;AAGjE,KAAI,OAAO,SAAS,GAAG;AACrB,WAAS,cAAc,OAAO;AAC9B,SAAO;;AAGT,QAAO;;AAGT,MAAMA,qBAAkC;CACtC;CACA;CACA;CACA;CACA;CACA;CACA;CACD;AAED,MAAM,yBAAyB,SAAkB,eAA8C;AAC7F,QAAO,WAAW,QACf,KAAK,cAAc;EAClB,MAAM,SAAS,UAAU,QAAQ;AACjC,SAAO;GACL,QAAQ,CAAC,GAAG,IAAI,QAAQ,GAAG,OAAO,OAAO;GACzC,UAAU,CAAC,GAAG,IAAI,UAAU,GAAG,OAAO,SAAS;GAChD;IAEH;EAAE,QAAQ,EAAE;EAAE,UAAU,EAAE;EAAE,CAC7B;;AAGH,MAAa,uBAAuB,YAAuC;AACzE,QAAO,sBAAsB,SAAS,mBAAmB"}