import { PythonError } from "./python-errors.mjs";
import fs from "fs";
import path from "path";

//#region src/cloud/build/builders/python/python-data/resolve-dep-names.ts
/**
* Resolve the name of the import from the name of the package
* @param depName the package name
* @returns a map of the import name to the package name
*/
const resolveDepNames = (depNames, sitePackagesDir) => {
	const folders = fs.readdirSync(sitePackagesDir).filter((folder) => fs.statSync(path.join(sitePackagesDir, folder)).isDirectory());
	const result = {};
	for (const depName of depNames) {
		const regex = /* @__PURE__ */ new RegExp(`^${depName.replace(/-/g, "[-_]")}-.*\\.dist-info$`);
		const folder = folders.find((folder$1) => regex.test(folder$1));
		if (folder) {
			const topLevelFile = fs.existsSync(path.join(sitePackagesDir, folder, "top_level.txt"));
			const recordFile = fs.existsSync(path.join(sitePackagesDir, folder, "RECORD"));
			if (topLevelFile) {
				const topLevel = fs.readFileSync(path.join(sitePackagesDir, folder, "top_level.txt"), "utf8").trim();
				result[topLevel] = depName;
			} else if (recordFile) {
				const recordLines = fs.readFileSync(path.join(sitePackagesDir, folder, "RECORD"), "utf8").trim().split("\n").filter((line) => line.trim());
				for (const line of recordLines) {
					const match = /^([^/]+)\/__init__\.py,/.exec(line);
					if (match) result[match[1]] = depName;
				}
			} else throw new PythonError(`Could not find dependency name in site-packages: ${depName}`, depName);
		} else throw new PythonError(`Could not find dependency name in site-packages: ${depName}`, depName);
	}
	return result;
};

//#endregion
export { resolveDepNames };
//# sourceMappingURL=resolve-dep-names.mjs.map