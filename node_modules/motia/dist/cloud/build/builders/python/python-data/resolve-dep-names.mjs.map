{"version":3,"file":"resolve-dep-names.mjs","names":["result: Record<string, string>","folder"],"sources":["../../../../../../src/cloud/build/builders/python/python-data/resolve-dep-names.ts"],"sourcesContent":["import fs from 'fs'\nimport path from 'path'\nimport { PythonError } from './python-errors'\n\n/**\n * Resolve the name of the import from the name of the package\n * @param depName the package name\n * @returns a map of the import name to the package name\n */\nexport const resolveDepNames = (depNames: string[], sitePackagesDir: string): Record<string, string> => {\n  const folders = fs\n    .readdirSync(sitePackagesDir)\n    .filter((folder) => fs.statSync(path.join(sitePackagesDir, folder)).isDirectory())\n\n  const result: Record<string, string> = {}\n\n  for (const depName of depNames) {\n    const regex = new RegExp(`^${depName.replace(/-/g, '[-_]')}-.*\\\\.dist-info$`)\n    const folder = folders.find((folder) => regex.test(folder))\n\n    if (folder) {\n      const topLevelFile = fs.existsSync(path.join(sitePackagesDir, folder, 'top_level.txt'))\n      const recordFile = fs.existsSync(path.join(sitePackagesDir, folder, 'RECORD'))\n\n      if (topLevelFile) {\n        const topLevel = fs.readFileSync(path.join(sitePackagesDir, folder, 'top_level.txt'), 'utf8').trim()\n        result[topLevel] = depName\n      } else if (recordFile) {\n        const record = fs.readFileSync(path.join(sitePackagesDir, folder, 'RECORD'), 'utf8').trim()\n\n        // Parse RECORD file to find the main module name\n        const recordLines = record.split('\\n').filter((line) => line.trim())\n\n        for (const line of recordLines) {\n          // RECORD format: path/__init__.py,sha256=hash,size\n          const match = /^([^/]+)\\/__init__\\.py,/.exec(line)\n\n          if (match) {\n            result[match[1]] = depName\n          }\n        }\n      } else {\n        throw new PythonError(`Could not find dependency name in site-packages: ${depName}`, depName)\n      }\n    } else {\n      throw new PythonError(`Could not find dependency name in site-packages: ${depName}`, depName)\n    }\n  }\n\n  return result\n}\n"],"mappings":";;;;;;;;;;AASA,MAAa,mBAAmB,UAAoB,oBAAoD;CACtG,MAAM,UAAU,GACb,YAAY,gBAAgB,CAC5B,QAAQ,WAAW,GAAG,SAAS,KAAK,KAAK,iBAAiB,OAAO,CAAC,CAAC,aAAa,CAAC;CAEpF,MAAMA,SAAiC,EAAE;AAEzC,MAAK,MAAM,WAAW,UAAU;EAC9B,MAAM,wBAAQ,IAAI,OAAO,IAAI,QAAQ,QAAQ,MAAM,OAAO,CAAC,kBAAkB;EAC7E,MAAM,SAAS,QAAQ,MAAM,aAAW,MAAM,KAAKC,SAAO,CAAC;AAE3D,MAAI,QAAQ;GACV,MAAM,eAAe,GAAG,WAAW,KAAK,KAAK,iBAAiB,QAAQ,gBAAgB,CAAC;GACvF,MAAM,aAAa,GAAG,WAAW,KAAK,KAAK,iBAAiB,QAAQ,SAAS,CAAC;AAE9E,OAAI,cAAc;IAChB,MAAM,WAAW,GAAG,aAAa,KAAK,KAAK,iBAAiB,QAAQ,gBAAgB,EAAE,OAAO,CAAC,MAAM;AACpG,WAAO,YAAY;cACV,YAAY;IAIrB,MAAM,cAHS,GAAG,aAAa,KAAK,KAAK,iBAAiB,QAAQ,SAAS,EAAE,OAAO,CAAC,MAAM,CAGhE,MAAM,KAAK,CAAC,QAAQ,SAAS,KAAK,MAAM,CAAC;AAEpE,SAAK,MAAM,QAAQ,aAAa;KAE9B,MAAM,QAAQ,0BAA0B,KAAK,KAAK;AAElD,SAAI,MACF,QAAO,MAAM,MAAM;;SAIvB,OAAM,IAAI,YAAY,oDAAoD,WAAW,QAAQ;QAG/F,OAAM,IAAI,YAAY,oDAAoD,WAAW,QAAQ;;AAIjG,QAAO"}