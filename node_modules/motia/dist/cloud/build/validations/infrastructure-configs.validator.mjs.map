{"version":3,"file":"infrastructure-configs.validator.mjs","names":["infrastructureConfigsValidator: Validator"],"sources":["../../../../src/cloud/build/validations/infrastructure-configs.validator.ts"],"sourcesContent":["import { type EventConfig, validateInfrastructureConfig } from '@motiadev/core'\nimport path from 'path'\nimport pc from 'picocolors'\nimport type { Validator } from './types'\n\nexport const infrastructureConfigsValidator: Validator = (builder) => {\n  const errors = []\n\n  const eventSteps = Object.values(builder.stepsConfig).filter(\n    (step) => step.config.type === 'event' && step.config.infrastructure,\n  )\n\n  for (const step of eventSteps) {\n    const config = step.config as EventConfig\n\n    const relativePath = path.relative(builder.projectDir, step.filePath)\n\n    const validationResult = validateInfrastructureConfig(config.infrastructure)\n\n    if (!validationResult.success && validationResult.errors) {\n      for (const error of validationResult.errors) {\n        errors.push({\n          relativePath,\n          message: [\n            `Infrastructure configuration error in step ${pc.magenta(step.config.name)}:`,\n            `  ${pc.red('âžœ')} ${error.path}: ${pc.red(error.message)}`,\n          ].join('\\n'),\n          step,\n        })\n      }\n    }\n  }\n\n  return { errors, warnings: [] }\n}\n"],"mappings":";;;;;AAKA,MAAaA,kCAA6C,YAAY;CACpE,MAAM,SAAS,EAAE;CAEjB,MAAM,aAAa,OAAO,OAAO,QAAQ,YAAY,CAAC,QACnD,SAAS,KAAK,OAAO,SAAS,WAAW,KAAK,OAAO,eACvD;AAED,MAAK,MAAM,QAAQ,YAAY;EAC7B,MAAM,SAAS,KAAK;EAEpB,MAAM,eAAe,KAAK,SAAS,QAAQ,YAAY,KAAK,SAAS;EAErE,MAAM,mBAAmB,6BAA6B,OAAO,eAAe;AAE5E,MAAI,CAAC,iBAAiB,WAAW,iBAAiB,OAChD,MAAK,MAAM,SAAS,iBAAiB,OACnC,QAAO,KAAK;GACV;GACA,SAAS,CACP,8CAA8C,GAAG,QAAQ,KAAK,OAAO,KAAK,CAAC,IAC3E,KAAK,GAAG,IAAI,IAAI,CAAC,GAAG,MAAM,KAAK,IAAI,GAAG,IAAI,MAAM,QAAQ,GACzD,CAAC,KAAK,KAAK;GACZ;GACD,CAAC;;AAKR,QAAO;EAAE;EAAQ,UAAU,EAAE;EAAE"}