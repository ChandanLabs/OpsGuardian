{"version":3,"file":"step-bundle-sizes.validator.mjs","names":["stepBundleSizesValidator: Validator"],"sources":["../../../../src/cloud/build/validations/step-bundle-sizes.validator.ts"],"sourcesContent":["import path from 'path'\nimport pc from 'picocolors'\nimport { BUNDLE_SIZE_LIMITS, BYTES_TO_MB } from './constants'\nimport type { Validator } from './types'\n\nexport const stepBundleSizesValidator: Validator = (builder) => {\n  const errors = []\n\n  for (const step of Object.values(builder.stepsConfig)) {\n    const relativePath = path.relative(builder.projectDir, step.filePath)\n    const stepUncompressedSize = builder.stepUncompressedSizes.get(step.filePath)\n\n    if (stepUncompressedSize !== undefined) {\n      const maxSize = BUNDLE_SIZE_LIMITS.STEP_MAX_MB * BYTES_TO_MB\n\n      if (stepUncompressedSize > maxSize) {\n        const sizeMB = (stepUncompressedSize / BYTES_TO_MB).toFixed(2)\n        const compressedSize = builder.stepCompressedSizes.get(step.filePath)\n        const compressedSizeMB = compressedSize ? (compressedSize / BYTES_TO_MB).toFixed(2) : 'unknown'\n\n        errors.push({\n          relativePath,\n          message: [\n            `Step bundle size exceeds ${BUNDLE_SIZE_LIMITS.STEP_MAX_MB}MB limit (uncompressed).`,\n            `  ${pc.red('➜')} Uncompressed size: ${pc.magenta(sizeMB + 'MB')}`,\n            `  ${pc.red('➜')} Compressed size: ${pc.cyan(compressedSizeMB + 'MB')}`,\n            `  ${pc.red('➜')} Maximum allowed: ${pc.blue(BUNDLE_SIZE_LIMITS.STEP_MAX_MB + 'MB')}`,\n          ].join('\\n'),\n          step,\n        })\n      }\n    }\n  }\n\n  return { errors, warnings: [] }\n}\n"],"mappings":";;;;;AAKA,MAAaA,4BAAuC,YAAY;CAC9D,MAAM,SAAS,EAAE;AAEjB,MAAK,MAAM,QAAQ,OAAO,OAAO,QAAQ,YAAY,EAAE;EACrD,MAAM,eAAe,KAAK,SAAS,QAAQ,YAAY,KAAK,SAAS;EACrE,MAAM,uBAAuB,QAAQ,sBAAsB,IAAI,KAAK,SAAS;AAE7E,MAAI,yBAAyB,QAG3B;OAAI,uBAFY,mBAAmB,cAAc,aAEb;IAClC,MAAM,UAAU,uBAAuB,aAAa,QAAQ,EAAE;IAC9D,MAAM,iBAAiB,QAAQ,oBAAoB,IAAI,KAAK,SAAS;IACrE,MAAM,mBAAmB,kBAAkB,iBAAiB,aAAa,QAAQ,EAAE,GAAG;AAEtF,WAAO,KAAK;KACV;KACA,SAAS;MACP,4BAA4B,mBAAmB,YAAY;MAC3D,KAAK,GAAG,IAAI,IAAI,CAAC,sBAAsB,GAAG,QAAQ,SAAS,KAAK;MAChE,KAAK,GAAG,IAAI,IAAI,CAAC,oBAAoB,GAAG,KAAK,mBAAmB,KAAK;MACrE,KAAK,GAAG,IAAI,IAAI,CAAC,oBAAoB,GAAG,KAAK,mBAAmB,cAAc,KAAK;MACpF,CAAC,KAAK,KAAK;KACZ;KACD,CAAC;;;;AAKR,QAAO;EAAE;EAAQ,UAAU,EAAE;EAAE"}