{"version":3,"file":"cli-output-manager.mjs","names":["msg"],"sources":["../../src/cloud/cli-output-manager.ts"],"sourcesContent":["import pc from 'picocolors'\nimport readline from 'readline'\nimport { table } from 'table'\n\nconst progress = pc.yellow('➜ [PROGRESS]')\nconst success = pc.green('✓ [SUCCESS]')\nconst failed = pc.red('✘ [ERROR]')\nconst warning = pc.yellow('! [WARNING]')\nconst info = pc.blue('i [INFO]')\n\nconst tags = {\n  success,\n  failed,\n  progress,\n  warning,\n  info,\n} as const\n\nconst colorTags = {\n  gray: pc.gray,\n  dark: pc.magenta,\n  red: pc.red,\n  green: pc.green,\n  yellow: pc.yellow,\n  blue: pc.blue,\n  magenta: pc.magenta,\n  cyan: pc.cyan,\n  white: pc.white,\n} as const\n\nexport class Message {\n  private output: string[]\n\n  constructor() {\n    this.output = []\n  }\n\n  dark(message: string): string {\n    return pc.magenta(message)\n  }\n\n  text(message: string): Message {\n    this.output.push(message)\n    return this\n  }\n\n  tag(tag: keyof typeof tags): Message {\n    this.output.push(tags[tag])\n    return this\n  }\n\n  append(message: string, color?: keyof typeof colorTags): Message {\n    if (color) {\n      this.output.push(colorTags[color](message))\n    } else {\n      this.output.push(message)\n    }\n    return this\n  }\n\n  box(messages: string[], color: keyof typeof colorTags = 'blue'): Message {\n    const message = messages.join('\\n \\n')\n    const lines = message.match(/.{1,40}/g) || [message]\n    const width = Math.min(40, Math.max(...lines.map((line) => line.length)))\n    const border = '─'.repeat(width + 2)\n    const borderColor = colorTags[color]\n\n    this.output.push(borderColor('\\n ┌' + border + '┐\\n'))\n    lines.forEach((line) => {\n      const padding = ' '.repeat(width - line.trim().length)\n      this.output.push(borderColor('│ ') + line.trim() + padding + borderColor(' │\\n'))\n    })\n    this.output.push(borderColor('└' + border + '┘'))\n    return this\n  }\n\n  table(headers: string[] | undefined, rows: string[][]): Message {\n    const colouredHeaders = headers?.map((header) => pc.blue(pc.bold(header)))\n    const records = [colouredHeaders, ...rows].filter((record) => record !== undefined)\n\n    this.output.push(\n      table(records, {\n        border: {\n          topBody: pc.blue('─'),\n          topJoin: pc.blue('┬'),\n          topLeft: pc.blue('┌'),\n          topRight: pc.blue('┐'),\n          bodyLeft: pc.blue('│'),\n          bodyRight: pc.blue('│'),\n          bottomBody: pc.blue('─'),\n          bottomJoin: pc.blue('┴'),\n          bottomLeft: pc.blue('└'),\n          bottomRight: pc.blue('┘'),\n          joinLeft: pc.blue('├'),\n          joinRight: pc.blue('┤'),\n          joinMiddleDown: pc.blue('│'),\n          joinMiddleUp: pc.blue(''),\n          joinMiddleLeft: pc.blue('│'),\n          joinMiddleRight: pc.blue('│'),\n          bodyJoin: pc.blue('│'),\n          joinBody: pc.blue('─'),\n          headerJoin: pc.blue('│'),\n          joinJoin: pc.blue('┼'),\n        },\n      }),\n    )\n    return this\n  }\n\n  toString(): string {\n    return this.output.join(' ')\n  }\n}\n\nexport class CLIOutputManager {\n  private lines: Map<string, number> = new Map() // Track line positions\n  private lineCount = 0\n\n  log(id: string, callback: (message: Message) => void) {\n    const lineIndex = this.lines.get(id)\n\n    if (lineIndex === undefined) {\n      const msg = this.createMessage()\n      callback(msg)\n      this.lines.set(id, this.lineCount)\n      process.stdout.write(`${msg.toString()}\\n`)\n      this.lineCount++\n\n      return\n    }\n\n    const msg = this.createMessage()\n    callback(msg)\n\n    readline.moveCursor(process.stdout, 0, -(this.lineCount - lineIndex))\n    readline.clearLine(process.stdout, 0)\n    process.stdout.write(`${msg.toString()}\\n`)\n    readline.moveCursor(process.stdout, 0, this.lineCount - lineIndex - 1)\n  }\n\n  createMessage(): Message {\n    return new Message()\n  }\n}\n"],"mappings":"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"}