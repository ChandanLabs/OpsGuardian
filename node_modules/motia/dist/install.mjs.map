{"version":3,"file":"install.mjs","names":[],"sources":["../src/install.ts"],"sourcesContent":["import fs from 'fs'\nimport path from 'path'\nimport { getStepFiles, getStreamFiles } from './generate-locked-data'\nimport { activatePythonVenv } from './utils/activate-python-env'\nimport { ensureUvInstalled } from './utils/ensure-uv'\nimport { executeCommand } from './utils/execute-command'\nimport { installLambdaPythonPackages } from './utils/install-lambda-python-packages'\nimport { getPythonCommand } from './utils/python-version-utils'\n\ninterface InstallConfig {\n  isVerbose?: boolean\n  pythonVersion?: string\n}\n\ntype PythonInstallConfig = InstallConfig & { baseDir: string }\n\nexport const pythonInstall = async ({\n  baseDir,\n  isVerbose = false,\n  pythonVersion = '3.13',\n}: PythonInstallConfig): Promise<void> => {\n  const venvPath = path.join(baseDir, 'python_modules')\n  console.log('üì¶ Installing Python dependencies...', venvPath)\n\n  const coreRequirementsPath = path.join(baseDir, 'node_modules', 'motia', 'dist', 'requirements-core.txt')\n  const snapRequirementsPath = path.join(baseDir, 'node_modules', 'motia', 'dist', 'requirements-snap.txt')\n  const localRequirements = path.join(baseDir, 'requirements.txt')\n\n  const requirementsList = [coreRequirementsPath, snapRequirementsPath, localRequirements]\n\n  try {\n    // Get the appropriate Python command\n    const pythonCmd = await getPythonCommand(pythonVersion, baseDir)\n    if (isVerbose) {\n      console.log(`üêç Using Python command: ${pythonCmd}`)\n    }\n\n    // Check if virtual environment exists\n    if (!fs.existsSync(venvPath)) {\n      console.log('üì¶ Creating Python virtual environment...')\n      await executeCommand(`${pythonCmd} -m venv python_modules`, baseDir)\n    }\n\n    activatePythonVenv({ baseDir, isVerbose, pythonVersion })\n\n    // Ensure UV is installed\n    console.log('üîß Checking UV installation...')\n    await ensureUvInstalled()\n    console.log('‚úÖ UV is available')\n\n    installLambdaPythonPackages({ isVerbose, requirementsList })\n\n    // Install requirements\n    console.log('üì• Installing Python dependencies...')\n\n    // Core requirements\n\n    for (const requirement of requirementsList) {\n      if (fs.existsSync(requirement)) {\n        if (isVerbose) {\n          console.log('üìÑ Using requirements from:', requirement)\n        }\n        await executeCommand(`pip install -r \"${requirement}\" --only-binary=:all:`, baseDir)\n      }\n    }\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : String(error)\n    console.error('‚ùå Installation failed:', errorMessage)\n    process.exit(1)\n  }\n}\n\nexport const install = async ({ isVerbose = false, pythonVersion = '3.13' }: InstallConfig): Promise<void> => {\n  const baseDir = process.cwd()\n\n  const steps = getStepFiles(baseDir)\n  const streams = getStreamFiles(baseDir)\n  if (steps.some((file) => file.endsWith('.py')) || streams.some((file) => file.endsWith('.py'))) {\n    await pythonInstall({ baseDir, isVerbose, pythonVersion })\n  }\n\n  console.info('‚úÖ Installation completed successfully!')\n\n  process.exit(0)\n}\n"],"mappings":";;;;;;;;;;AAgBA,MAAa,gBAAgB,OAAO,EAClC,SACA,YAAY,OACZ,gBAAgB,aACwB;CACxC,MAAM,WAAW,KAAK,KAAK,SAAS,iBAAiB;AACrD,SAAQ,IAAI,wCAAwC,SAAS;CAM7D,MAAM,mBAAmB;EAJI,KAAK,KAAK,SAAS,gBAAgB,SAAS,QAAQ,wBAAwB;EAC5E,KAAK,KAAK,SAAS,gBAAgB,SAAS,QAAQ,wBAAwB;EAC/E,KAAK,KAAK,SAAS,mBAAmB;EAEwB;AAExF,KAAI;EAEF,MAAM,YAAY,MAAM,iBAAiB,eAAe,QAAQ;AAChE,MAAI,UACF,SAAQ,IAAI,4BAA4B,YAAY;AAItD,MAAI,CAAC,GAAG,WAAW,SAAS,EAAE;AAC5B,WAAQ,IAAI,4CAA4C;AACxD,SAAM,eAAe,GAAG,UAAU,0BAA0B,QAAQ;;AAGtE,qBAAmB;GAAE;GAAS;GAAW;GAAe,CAAC;AAGzD,UAAQ,IAAI,iCAAiC;AAC7C,QAAM,mBAAmB;AACzB,UAAQ,IAAI,oBAAoB;AAEhC,8BAA4B;GAAE;GAAW;GAAkB,CAAC;AAG5D,UAAQ,IAAI,uCAAuC;AAInD,OAAK,MAAM,eAAe,iBACxB,KAAI,GAAG,WAAW,YAAY,EAAE;AAC9B,OAAI,UACF,SAAQ,IAAI,+BAA+B,YAAY;AAEzD,SAAM,eAAe,mBAAmB,YAAY,wBAAwB,QAAQ;;UAGjF,OAAO;EACd,MAAM,eAAe,iBAAiB,QAAQ,MAAM,UAAU,OAAO,MAAM;AAC3E,UAAQ,MAAM,0BAA0B,aAAa;AACrD,UAAQ,KAAK,EAAE;;;AAInB,MAAa,UAAU,OAAO,EAAE,YAAY,OAAO,gBAAgB,aAA2C;CAC5G,MAAM,UAAU,QAAQ,KAAK;CAE7B,MAAM,QAAQ,aAAa,QAAQ;CACnC,MAAM,UAAU,eAAe,QAAQ;AACvC,KAAI,MAAM,MAAM,SAAS,KAAK,SAAS,MAAM,CAAC,IAAI,QAAQ,MAAM,SAAS,KAAK,SAAS,MAAM,CAAC,CAC5F,OAAM,cAAc;EAAE;EAAS;EAAW;EAAe,CAAC;AAG5D,SAAQ,KAAK,yCAAyC;AAEtD,SAAQ,KAAK,EAAE"}