{"version":3,"file":"cli.mjs","names":[],"sources":["../src/cli.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport 'dotenv/config'\n\nimport { program } from 'commander'\nimport { type CliContext, handler } from './cloud/config-utils'\nimport './cloud/index'\nimport { loadMotiaConfig } from './load-motia-config'\nimport { wrapAction } from './utils/analytics'\nimport { version } from './version'\n\nconst defaultPort = 3000\nconst defaultHost = '0.0.0.0'\n\nprogram\n  .command('version')\n  .description('Display detailed version information')\n  .action(() => {\n    console.log(`Motia CLI v${version}`)\n    process.exit(0)\n  })\n\nprogram\n  .command('create [name]')\n  .description('Create a new motia project')\n  .option('-t, --template <template>', 'The template to use for your project')\n  .option('-p, --plugin', 'Create a plugin project')\n  .option('-i, --interactive', 'Use interactive prompts to create project') // it's default\n  .option('--skip-redis', 'Skip Redis binary installation and use external Redis')\n  .action((projectName, options) => {\n    const mergedArgs = { ...options, name: projectName }\n    return handler(async (arg: any, context: CliContext) => {\n      const { createInteractive } = await import('./create/interactive')\n      await createInteractive(\n        {\n          name: arg.name,\n          template: arg.template,\n          plugin: !!arg.plugin,\n          skipRedis: !!arg.skipRedis,\n        },\n        context,\n      )\n    })(mergedArgs)\n  })\n\nprogram\n  .command('rules')\n  .command('pull')\n  .description('Install essential AI development guides (AGENTS.md, CLAUDE.md) and optional Cursor IDE rules')\n  .option('-f, --force', 'Overwrite existing files')\n  .action(\n    handler(async (arg: any, context: CliContext) => {\n      const { pullRules } = await import('./create/pull-rules')\n      await pullRules({ force: arg.force, rootDir: process.cwd() }, context)\n    }),\n  )\n\nprogram\n  .command('generate-types')\n  .description('Generate types.d.ts file for your project')\n  .action(\n    wrapAction(async () => {\n      const { generateTypes } = await import('./generate-types')\n      await generateTypes(process.cwd())\n      process.exit(0)\n    }),\n  )\n\nprogram\n  .command('install')\n  .description('Sets up Python virtual environment and install dependencies')\n  .option('-v, --verbose', 'Enable verbose logging')\n  .action(\n    wrapAction(async (options: any) => {\n      const { install } = await import('./install')\n      await install({ isVerbose: options.verbose })\n    }),\n  )\n\nprogram\n  .command('dev')\n  .description('Start the development server')\n  .option('-p, --port <port>', 'The port to run the server on', `${defaultPort}`)\n  .option('-H, --host [host]', 'The host address for the server', `${defaultHost}`)\n  .option('-v, --disable-verbose', 'Disable verbose logging')\n  .option('-d, --debug', 'Enable debug logging')\n  .option('-m, --mermaid', 'Enable mermaid diagram generation')\n  .option('--motia-dir <path>', 'Path where .motia folder will be created')\n  .action(\n    wrapAction(async (arg: any) => {\n      if (arg.debug) {\n        console.log('üîç Debug logging enabled')\n        process.env.LOG_LEVEL = 'debug'\n      }\n\n      const port = arg.port ? parseInt(arg.port) : defaultPort\n      const host = arg.host ? arg.host : defaultHost\n      const { dev } = await import('./dev')\n      await dev(port, host, arg.disableVerbose, arg.mermaid, arg.motiaDir)\n    }),\n  )\n\nprogram\n  .command('start')\n  .description('Start a server to run your Motia project')\n  .option('-p, --port <port>', 'The port to run the server on', `${defaultPort}`)\n  .option('-H, --host [host]', 'The host address for the server', `${defaultHost}`)\n  .option('-v, --disable-verbose', 'Disable verbose logging')\n  .option('-d, --debug', 'Enable debug logging')\n  .option('--motia-dir <path>', 'Path where .motia folder will be created')\n  .action(\n    wrapAction(async (arg: any) => {\n      if (arg.debug) {\n        console.log('üîç Debug logging enabled')\n        process.env.LOG_LEVEL = 'debug'\n      }\n\n      const port = arg.port ? parseInt(arg.port) : defaultPort\n      const host = arg.host ? arg.host : defaultHost\n      const { start } = await import('./start')\n      await start(port, host, arg.disableVerbose, arg.motiaDir)\n    }),\n  )\n\nprogram\n  .command('emit')\n  .description('Emit an event to the Motia server')\n  .requiredOption('--topic <topic>', 'Event topic/type to emit')\n  .requiredOption('--message <message>', 'Event payload as JSON string')\n  .option('-p, --port <number>', 'Port number (default: 3000)')\n  .action(\n    wrapAction(async (options: any) => {\n      const port = options.port || 3000\n      const url = `http://localhost:${port}/emit`\n\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          topic: options.topic,\n          data: JSON.parse(options.message),\n        }),\n      })\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`)\n      }\n\n      const result = await response.json()\n      console.log('Event emitted successfully:', result)\n    }),\n  )\n\nconst generate = program.command('generate').description('Generate motia resources')\n\ngenerate\n  .command('step')\n  .description('Create a new step with interactive prompts')\n  .option('-d, --dir <step file path>', 'The path relative to the src directory, used to create the step file')\n  .action(\n    wrapAction(async (arg: any) => {\n      const { createStep } = await import('./create-step/index')\n      return createStep({\n        stepFilePath: arg.dir,\n      })\n    }),\n  )\n\ngenerate\n  .command('openapi')\n  .description('Generate OpenAPI spec for your project')\n  .option('-t, --title <title>', 'Title for the OpenAPI document. Defaults to project name')\n  .option('-v, --version <version>', 'Version for the OpenAPI document. Defaults to 1.0.0', '1.0.0')\n  .option('-o, --output <output>', 'Output file for the OpenAPI document. Defaults to openapi.json', 'openapi.json')\n  .action(\n    wrapAction(async (options: any) => {\n      const { generateLockedData, getStepFiles, getStreamFiles } = await import('./generate-locked-data')\n      const { validatePythonEnvironment } = await import('./utils/validate-python-environment')\n      const { activatePythonVenv } = await import('./utils/activate-python-env')\n      const { generateOpenApi } = await import('./openapi/generate')\n      const { MemoryStreamAdapterManager } = await import('@motiadev/core')\n\n      const baseDir = process.cwd()\n      const appConfig = await loadMotiaConfig(baseDir)\n\n      const stepFiles = [...getStepFiles(baseDir), ...getStreamFiles(baseDir)]\n      const hasPythonFiles = stepFiles.some((file) => file.endsWith('.py'))\n\n      const pythonValidation = await validatePythonEnvironment({ baseDir, hasPythonFiles })\n      if (!pythonValidation.success) {\n        process.exit(1)\n      }\n\n      if (hasPythonFiles) {\n        activatePythonVenv({ baseDir })\n      }\n\n      const lockedData = await generateLockedData({\n        projectDir: baseDir,\n        streamAdapter: new MemoryStreamAdapterManager(),\n        streamAuth: appConfig.streamAuth,\n        printerType: 'disabled',\n      })\n      const apiSteps = lockedData.apiSteps()\n\n      generateOpenApi(process.cwd(), apiSteps, options.title, options.version, options.output)\n      process.exit(0)\n    }),\n  )\n\nconst docker = program.command('docker').description('Motia docker commands')\n\ndocker\n  .command('setup')\n  .description('Setup a motia-docker for your project')\n  .action(\n    wrapAction(async () => {\n      const { setup } = await import('./docker/setup')\n      await setup()\n      process.exit(0)\n    }),\n  )\n\ndocker\n  .command('run')\n  .description('Build and run your project in a docker container')\n  .option('-p, --port <port>', 'The port to run the server on', `${defaultPort}`)\n  .option('-n, --project-name <project name>', 'The name for your project')\n  .option('-s, --skip-build', 'Skip docker build')\n  .action(\n    wrapAction(async (arg: any) => {\n      const { run } = await import('./docker/run')\n      await run(arg.port, arg.projectName, arg.skipBuild)\n      process.exit(0)\n    }),\n  )\n\ndocker\n  .command('build')\n  .description('Build your project in a docker container')\n  .option('-n, --project-name <project name>', 'The name for your project')\n  .action(\n    wrapAction(async (arg: any) => {\n      const { build } = await import('./docker/build')\n      await build(arg.projectName)\n      process.exit(0)\n    }),\n  )\n\nprogram.version(version, '-V, --version', 'Output the current version')\nprogram.parseAsync(process.argv).catch(() => {\n  process.exit(1)\n})\n"],"mappings":"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"}