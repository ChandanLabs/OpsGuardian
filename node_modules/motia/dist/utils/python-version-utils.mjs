import { internalLogger } from "./internal-logger.mjs";
import { executeCommand } from "./execute-command.mjs";
import fs from "fs";
import path from "path";

//#region src/utils/python-version-utils.ts
async function checkPythonVersionExists(pythonCmd, baseDir) {
	try {
		await executeCommand(`${pythonCmd} --version`, baseDir, { silent: true });
		return true;
	} catch (error) {
		return false;
	}
}
async function getPythonCommand(requestedVersion, baseDir) {
	const specificPythonCmd = `python${requestedVersion}`;
	if (await checkPythonVersionExists(specificPythonCmd, baseDir)) return specificPythonCmd;
	try {
		const versionMatch = (await executeCommand("python --version", baseDir, { silent: true })).match(/Python\s+(\d+)\.(\d+)\.(\d+)/);
		if (versionMatch && parseInt(versionMatch[1], 10) >= 3) return "python";
	} catch (error) {}
	try {
		const versionMatch = (await executeCommand("python3 --version", baseDir, { silent: true })).match(/Python\s+(\d+)\.(\d+)\.(\d+)/);
		if (versionMatch && parseInt(versionMatch[1], 10) >= 3) return "python3";
	} catch (error) {}
	throw new Error("No compatible Python 3 installation found. Please install Python 3.");
}
function findPythonSitePackagesDir(venvLibPath, pythonVersion) {
	let pythonVersionPath = `python${pythonVersion}`;
	if (!venvLibPath || !pythonVersion) return pythonVersionPath;
	try {
		if (venvLibPath && !fs.existsSync(path.join(venvLibPath, pythonVersionPath))) {
			const pythonDirs = fs.readdirSync(venvLibPath).filter((item) => item.startsWith("python3"));
			if (pythonDirs.length > 0) {
				pythonVersionPath = pythonDirs[0];
				internalLogger.info("Found Python directory", pythonVersionPath);
			}
		}
	} catch (error) {
		internalLogger.warn("Could not determine Python version directory", error.message);
	}
	return pythonVersionPath;
}

//#endregion
export { findPythonSitePackagesDir, getPythonCommand };
//# sourceMappingURL=python-version-utils.mjs.map