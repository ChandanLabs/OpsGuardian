{"version":3,"file":"ensure-uv.mjs","names":[],"sources":["../../src/utils/ensure-uv.ts"],"sourcesContent":["import { spawn } from 'child_process'\n\nexport const ensureUvInstalled = async (): Promise<void> => {\n  if (!(await checkCommand('uv', ['--version']))) {\n    if (await installUv()) {\n      console.log('✅ UV installed successfully via pip')\n    } else {\n      throw new Error(\n        'UV could not be installed automatically. Please install manually using one of these methods:\\n' +\n          '  • pip install uv (recommended)\\n' +\n          '  • pip3 install uv\\n' +\n          '  • brew install uv (macOS)\\n' +\n          '  • curl -LsSf https://astral.sh/uv/install.sh | sh (if pip is not available)\\n' +\n          'For more information, visit: https://github.com/astral-sh/uv',\n      )\n    }\n  }\n}\n\nconst checkCommand = async (command: string, args: string[]): Promise<boolean> => {\n  return new Promise((resolve) => {\n    const child = spawn(command, args, { stdio: 'pipe' })\n    child.on('close', (code) => resolve(code === 0))\n    child.on('error', () => resolve(false))\n  })\n}\n\nconst installUv = async (): Promise<boolean> => {\n  console.log('Installing UV via pip...')\n\n  try {\n    const pipAvailable = await checkCommand('pip', ['--version'])\n\n    if (!pipAvailable) {\n      throw new Error('Pip is not available. Cannot auto-install UV.')\n    }\n\n    await runCommand('pip', ['install', 'uv'])\n    return await verifyUvInstallation()\n  } catch (error) {\n    console.error('Failed to install UV via pip:', error)\n    return false\n  }\n}\n\nasync function runCommand(command: string, args: string[]): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const child = spawn(command, args, {\n      stdio: ['pipe', 'pipe', 'pipe'],\n    })\n\n    let stdout = ''\n    let stderr = ''\n\n    child.stdout?.on('data', (data) => {\n      stdout += data.toString()\n    })\n\n    child.stderr?.on('data', (data) => {\n      stderr += data.toString()\n    })\n\n    child.on('close', (code) => {\n      if (code === 0) {\n        resolve(stdout)\n      } else {\n        const errorPrefix = `Command '${command}'`\n        reject(new Error(`${errorPrefix} failed: ${stderr || stdout}`))\n      }\n    })\n\n    child.on('error', (error) => {\n      reject(new Error(`Failed to spawn ${command}: ${error.message}`))\n    })\n  })\n}\n\nconst verifyUvInstallation = async (): Promise<boolean> => {\n  // Give the system a moment to update PATH\n  await new Promise((resolve) => setTimeout(resolve, 500))\n\n  // Try to run UV to verify it's installed\n  try {\n    await runCommand('uv', ['--version'])\n    return true\n  } catch {\n    return false\n  }\n}\n"],"mappings":";;;AAEA,MAAa,oBAAoB,YAA2B;AAC1D,KAAI,CAAE,MAAM,aAAa,MAAM,CAAC,YAAY,CAAC,CAC3C,KAAI,MAAM,WAAW,CACnB,SAAQ,IAAI,sCAAsC;KAElD,OAAM,IAAI,MACR,gUAMD;;AAKP,MAAM,eAAe,OAAO,SAAiB,SAAqC;AAChF,QAAO,IAAI,SAAS,YAAY;EAC9B,MAAM,QAAQ,MAAM,SAAS,MAAM,EAAE,OAAO,QAAQ,CAAC;AACrD,QAAM,GAAG,UAAU,SAAS,QAAQ,SAAS,EAAE,CAAC;AAChD,QAAM,GAAG,eAAe,QAAQ,MAAM,CAAC;GACvC;;AAGJ,MAAM,YAAY,YAA8B;AAC9C,SAAQ,IAAI,2BAA2B;AAEvC,KAAI;AAGF,MAAI,CAFiB,MAAM,aAAa,OAAO,CAAC,YAAY,CAAC,CAG3D,OAAM,IAAI,MAAM,gDAAgD;AAGlE,QAAM,WAAW,OAAO,CAAC,WAAW,KAAK,CAAC;AAC1C,SAAO,MAAM,sBAAsB;UAC5B,OAAO;AACd,UAAQ,MAAM,iCAAiC,MAAM;AACrD,SAAO;;;AAIX,eAAe,WAAW,SAAiB,MAAiC;AAC1E,QAAO,IAAI,SAAS,SAAS,WAAW;EACtC,MAAM,QAAQ,MAAM,SAAS,MAAM,EACjC,OAAO;GAAC;GAAQ;GAAQ;GAAO,EAChC,CAAC;EAEF,IAAI,SAAS;EACb,IAAI,SAAS;AAEb,QAAM,QAAQ,GAAG,SAAS,SAAS;AACjC,aAAU,KAAK,UAAU;IACzB;AAEF,QAAM,QAAQ,GAAG,SAAS,SAAS;AACjC,aAAU,KAAK,UAAU;IACzB;AAEF,QAAM,GAAG,UAAU,SAAS;AAC1B,OAAI,SAAS,EACX,SAAQ,OAAO;QACV;IACL,MAAM,cAAc,YAAY,QAAQ;AACxC,2BAAO,IAAI,MAAM,GAAG,YAAY,WAAW,UAAU,SAAS,CAAC;;IAEjE;AAEF,QAAM,GAAG,UAAU,UAAU;AAC3B,0BAAO,IAAI,MAAM,mBAAmB,QAAQ,IAAI,MAAM,UAAU,CAAC;IACjE;GACF;;AAGJ,MAAM,uBAAuB,YAA8B;AAEzD,OAAM,IAAI,SAAS,YAAY,WAAW,SAAS,IAAI,CAAC;AAGxD,KAAI;AACF,QAAM,WAAW,MAAM,CAAC,YAAY,CAAC;AACrC,SAAO;SACD;AACN,SAAO"}