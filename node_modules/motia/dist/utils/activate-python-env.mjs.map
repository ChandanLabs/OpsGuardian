{"version":3,"file":"activate-python-env.mjs","names":["path"],"sources":["../../src/utils/activate-python-env.ts"],"sourcesContent":["import fs from 'fs'\nimport path from 'path'\nimport { internalLogger } from './internal-logger'\nimport { findPythonSitePackagesDir } from './python-version-utils'\n\ninterface VenvConfig {\n  baseDir: string\n  isVerbose?: boolean\n  pythonVersion?: string\n}\n\nexport const getSitePackagesPath = ({ baseDir, pythonVersion = '3.13' }: VenvConfig): string => {\n  const venvPath = path.join(baseDir, 'python_modules')\n  const libPath = path.join(venvPath, 'lib')\n  const actualPythonVersionPath = findPythonSitePackagesDir(libPath, pythonVersion)\n  return path.join(venvPath, 'lib', actualPythonVersionPath, 'site-packages')\n}\n\nexport const activatePythonVenv = ({ baseDir, isVerbose = false, pythonVersion = '3.13' }: VenvConfig): void => {\n  internalLogger.info('Activating Python environment')\n\n  // Set the virtual environment path\n  const venvPath = path.join(baseDir, 'python_modules')\n  const venvBinPath = path.join(venvPath, process.platform === 'win32' ? 'Scripts' : 'bin')\n\n  // Find the Python version directory using the utility function\n  const sitePackagesPath = getSitePackagesPath({ baseDir, pythonVersion })\n\n  // Add virtual environment to PATH\n  process.env.PATH = `${venvBinPath}${path.delimiter}${process.env.PATH}`\n  // Set VIRTUAL_ENV environment variable\n  process.env.VIRTUAL_ENV = venvPath\n  // Set PYTHON_SITE_PACKAGES with the site-packages path\n  process.env.PYTHON_SITE_PACKAGES = sitePackagesPath\n  // Remove PYTHONHOME if it exists as it can interfere with venv\n  delete process.env.PYTHONHOME\n\n  // Log Python environment information if verbose mode is enabled\n  if (isVerbose) {\n    const pythonPath =\n      process.platform === 'win32' ? path.join(venvBinPath, 'python.exe') : path.join(venvBinPath, 'python')\n\n    const relativePath = (path: string) => path.replace(baseDir, '<projectDir>')\n\n    internalLogger.info('Using Python', relativePath(pythonPath))\n    internalLogger.info('Site-packages path', relativePath(sitePackagesPath))\n  }\n}\n"],"mappings":";;;;;AAWA,MAAa,uBAAuB,EAAE,SAAS,gBAAgB,aAAiC;CAC9F,MAAM,WAAW,KAAK,KAAK,SAAS,iBAAiB;CAErD,MAAM,0BAA0B,0BADhB,KAAK,KAAK,UAAU,MAAM,EACyB,cAAc;AACjF,QAAO,KAAK,KAAK,UAAU,OAAO,yBAAyB,gBAAgB;;AAG7E,MAAa,sBAAsB,EAAE,SAAS,YAAY,OAAO,gBAAgB,aAA+B;AAC9G,gBAAe,KAAK,gCAAgC;CAGpD,MAAM,WAAW,KAAK,KAAK,SAAS,iBAAiB;CACrD,MAAM,cAAc,KAAK,KAAK,UAAU,QAAQ,aAAa,UAAU,YAAY,MAAM;CAGzF,MAAM,mBAAmB,oBAAoB;EAAE;EAAS;EAAe,CAAC;AAGxE,SAAQ,IAAI,OAAO,GAAG,cAAc,KAAK,YAAY,QAAQ,IAAI;AAEjE,SAAQ,IAAI,cAAc;AAE1B,SAAQ,IAAI,uBAAuB;AAEnC,QAAO,QAAQ,IAAI;AAGnB,KAAI,WAAW;EACb,MAAM,aACJ,QAAQ,aAAa,UAAU,KAAK,KAAK,aAAa,aAAa,GAAG,KAAK,KAAK,aAAa,SAAS;EAExG,MAAM,gBAAgB,WAAiBA,OAAK,QAAQ,SAAS,eAAe;AAE5E,iBAAe,KAAK,gBAAgB,aAAa,WAAW,CAAC;AAC7D,iBAAe,KAAK,sBAAsB,aAAa,iBAAiB,CAAC"}