import { internalLogger } from "./internal-logger.mjs";
import fs from "fs";
import { execSync } from "child_process";

//#region src/utils/install-lambda-python-packages.ts
const installLambdaPythonPackages = ({ isVerbose = false, requirementsList }) => {
	const sitePackagesPath = `${process.env.PYTHON_SITE_PACKAGES}-lambda`;
	for (const requirement of requirementsList) {
		if (!fs.existsSync(requirement)) {
			if (isVerbose) internalLogger.warn(`requirements.txt not found at ${requirement}`);
			return;
		}
		try {
			const command = `pip install -r "${requirement}" --target "${sitePackagesPath}" --platform manylinux2014_x86_64 --only-binary=:all: --upgrade --upgrade-strategy only-if-needed`;
			if (isVerbose) {
				console.log("ðŸ“¦ Installing Python packages with platform specification...");
				console.log("ðŸ“¦ Command:", command);
			}
			execSync(command, { stdio: "inherit" });
			internalLogger.info("Python packages for lambda installed successfully");
		} catch (error) {
			internalLogger.error("Failed to install Python packages for lambda", error.message);
			throw error;
		}
	}
};

//#endregion
export { installLambdaPythonPackages };
//# sourceMappingURL=install-lambda-python-packages.mjs.map