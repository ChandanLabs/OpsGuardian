{"version":3,"file":"validate-python-environment.mjs","names":["error: any"],"sources":["../../src/utils/validate-python-environment.ts"],"sourcesContent":["import fs from 'fs'\nimport path from 'path'\nimport { getPackageManager } from './get-package-manager'\nimport { internalLogger } from './internal-logger'\nimport { getPythonCommand } from './python-version-utils'\n\nexport interface ValidationResult {\n  success: boolean\n  hasPythonFiles: boolean\n}\n\ninterface ValidateConfig {\n  baseDir: string\n  hasPythonFiles: boolean\n  pythonVersion?: string\n}\n\nfunction getInstallCommand(baseDir: string): string {\n  const pm = getPackageManager(baseDir)\n  switch (pm) {\n    case 'yarn':\n      return 'yarn install'\n    case 'pnpm':\n      return 'pnpm install'\n    case 'npm':\n    default:\n      return 'npm install'\n  }\n}\n\nexport async function validatePythonEnvironment({\n  baseDir,\n  hasPythonFiles,\n  pythonVersion = '3.13',\n}: ValidateConfig): Promise<ValidationResult> {\n  if (!hasPythonFiles) {\n    return { success: true, hasPythonFiles: false }\n  }\n\n  const installCmd = getInstallCommand(baseDir)\n\n  try {\n    await getPythonCommand(pythonVersion, baseDir)\n  } catch {\n    internalLogger.error('Python is not installed')\n    internalLogger.info('Python files were detected in your project but Python 3 is not available')\n    internalLogger.info('Please install Python 3.10 or higher: https://www.python.org/downloads/')\n    return { success: false, hasPythonFiles: true }\n  }\n\n  const venvPath = path.join(baseDir, 'python_modules')\n  if (!fs.existsSync(venvPath)) {\n    internalLogger.error('Python environment not configured')\n    internalLogger.info('The python_modules directory was not found')\n    internalLogger.info(`Run '${installCmd}' to set up your Python environment`)\n    return { success: false, hasPythonFiles: true }\n  }\n\n  const libPath = path.join(venvPath, 'lib')\n  if (!fs.existsSync(libPath)) {\n    internalLogger.error('Python environment is incomplete')\n    internalLogger.info('The python_modules directory exists but appears to be corrupted')\n    internalLogger.info(`Run '${installCmd}' to recreate your Python environment`)\n    return { success: false, hasPythonFiles: true }\n  }\n\n  try {\n    const libContents = fs.readdirSync(libPath)\n    const pythonDirs = libContents.filter((item) => item.startsWith('python3'))\n\n    if (pythonDirs.length === 0) {\n      internalLogger.error('Python environment is incomplete')\n      internalLogger.info('The python_modules/lib directory exists but contains no Python version directories')\n      internalLogger.info(`Run '${installCmd}' to recreate your Python environment`)\n      return { success: false, hasPythonFiles: true }\n    }\n  } catch (error: any) {\n    internalLogger.error('Python environment is incomplete')\n    internalLogger.info('The python_modules/lib directory cannot be read')\n    internalLogger.info(`Run '${installCmd}' to recreate your Python environment`)\n    return { success: false, hasPythonFiles: true }\n  }\n\n  return { success: true, hasPythonFiles: true }\n}\n"],"mappings":";;;;;;;AAiBA,SAAS,kBAAkB,SAAyB;AAElD,SADW,kBAAkB,QAAQ,EACrC;EACE,KAAK,OACH,QAAO;EACT,KAAK,OACH,QAAO;EACT,KAAK;EACL,QACE,QAAO;;;AAIb,eAAsB,0BAA0B,EAC9C,SACA,gBACA,gBAAgB,UAC4B;AAC5C,KAAI,CAAC,eACH,QAAO;EAAE,SAAS;EAAM,gBAAgB;EAAO;CAGjD,MAAM,aAAa,kBAAkB,QAAQ;AAE7C,KAAI;AACF,QAAM,iBAAiB,eAAe,QAAQ;SACxC;AACN,iBAAe,MAAM,0BAA0B;AAC/C,iBAAe,KAAK,2EAA2E;AAC/F,iBAAe,KAAK,0EAA0E;AAC9F,SAAO;GAAE,SAAS;GAAO,gBAAgB;GAAM;;CAGjD,MAAM,WAAW,KAAK,KAAK,SAAS,iBAAiB;AACrD,KAAI,CAAC,GAAG,WAAW,SAAS,EAAE;AAC5B,iBAAe,MAAM,oCAAoC;AACzD,iBAAe,KAAK,6CAA6C;AACjE,iBAAe,KAAK,QAAQ,WAAW,qCAAqC;AAC5E,SAAO;GAAE,SAAS;GAAO,gBAAgB;GAAM;;CAGjD,MAAM,UAAU,KAAK,KAAK,UAAU,MAAM;AAC1C,KAAI,CAAC,GAAG,WAAW,QAAQ,EAAE;AAC3B,iBAAe,MAAM,mCAAmC;AACxD,iBAAe,KAAK,kEAAkE;AACtF,iBAAe,KAAK,QAAQ,WAAW,uCAAuC;AAC9E,SAAO;GAAE,SAAS;GAAO,gBAAgB;GAAM;;AAGjD,KAAI;AAIF,MAHoB,GAAG,YAAY,QAAQ,CACZ,QAAQ,SAAS,KAAK,WAAW,UAAU,CAAC,CAE5D,WAAW,GAAG;AAC3B,kBAAe,MAAM,mCAAmC;AACxD,kBAAe,KAAK,qFAAqF;AACzG,kBAAe,KAAK,QAAQ,WAAW,uCAAuC;AAC9E,UAAO;IAAE,SAAS;IAAO,gBAAgB;IAAM;;UAE1CA,OAAY;AACnB,iBAAe,MAAM,mCAAmC;AACxD,iBAAe,KAAK,kDAAkD;AACtE,iBAAe,KAAK,QAAQ,WAAW,uCAAuC;AAC9E,SAAO;GAAE,SAAS;GAAO,gBAAgB;GAAM;;AAGjD,QAAO;EAAE,SAAS;EAAM,gBAAgB;EAAM"}