{"version":3,"file":"get-package-manager.mjs","names":[],"sources":["../../src/utils/get-package-manager.ts"],"sourcesContent":["import fs from 'fs'\nimport path from 'path'\nimport { checkIfFileExists } from '../create/utils'\n\nexport const getPackageManagerFromEnv = (): string | null => {\n  const userAgent = process.env.npm_config_user_agent\n  if (!userAgent) {\n    return null\n  }\n\n  const match = userAgent.match(/^(npm|pnpm|yarn|bun)\\//)\n  if (match) {\n    return match[1]\n  }\n\n  return null\n}\n\nconst readPackageManagerFromPackageJson = (dir: string): string | null => {\n  const packageJsonPath = path.join(dir, 'package.json')\n  if (!checkIfFileExists(dir, 'package.json')) {\n    return null\n  }\n\n  try {\n    const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'))\n    if (packageJson.packageManager) {\n      const pm = packageJson.packageManager.split('@')[0]\n      if (['npm', 'yarn', 'pnpm', 'bun'].includes(pm)) {\n        return pm\n      }\n    }\n  } catch {\n    return null\n  }\n\n  return null\n}\n\nexport const getPackageManager = (dir: string): string => {\n  const envPackageManager = getPackageManagerFromEnv()\n  if (envPackageManager) {\n    return envPackageManager\n  }\n\n  let currentDir = dir\n\n  while (currentDir !== path.dirname(currentDir)) {\n    if (checkIfFileExists(currentDir, 'yarn.lock')) {\n      return 'yarn'\n    } else if (checkIfFileExists(currentDir, 'pnpm-lock.yaml')) {\n      return 'pnpm'\n    } else if (checkIfFileExists(currentDir, 'package-lock.json')) {\n      return 'npm'\n    } else if (checkIfFileExists(currentDir, 'bun.lockb') || checkIfFileExists(currentDir, 'bun.lock')) {\n      return 'bun'\n    }\n\n    const packageManagerFromJson = readPackageManagerFromPackageJson(currentDir)\n    if (packageManagerFromJson) {\n      return packageManagerFromJson\n    }\n\n    currentDir = path.dirname(currentDir)\n  }\n\n  return 'npm'\n}\n"],"mappings":";;;;;AAIA,MAAa,iCAAgD;CAC3D,MAAM,YAAY,QAAQ,IAAI;AAC9B,KAAI,CAAC,UACH,QAAO;CAGT,MAAM,QAAQ,UAAU,MAAM,yBAAyB;AACvD,KAAI,MACF,QAAO,MAAM;AAGf,QAAO;;AAGT,MAAM,qCAAqC,QAA+B;CACxE,MAAM,kBAAkB,KAAK,KAAK,KAAK,eAAe;AACtD,KAAI,CAAC,kBAAkB,KAAK,eAAe,CACzC,QAAO;AAGT,KAAI;EACF,MAAM,cAAc,KAAK,MAAM,GAAG,aAAa,iBAAiB,QAAQ,CAAC;AACzE,MAAI,YAAY,gBAAgB;GAC9B,MAAM,KAAK,YAAY,eAAe,MAAM,IAAI,CAAC;AACjD,OAAI;IAAC;IAAO;IAAQ;IAAQ;IAAM,CAAC,SAAS,GAAG,CAC7C,QAAO;;SAGL;AACN,SAAO;;AAGT,QAAO;;AAGT,MAAa,qBAAqB,QAAwB;CACxD,MAAM,oBAAoB,0BAA0B;AACpD,KAAI,kBACF,QAAO;CAGT,IAAI,aAAa;AAEjB,QAAO,eAAe,KAAK,QAAQ,WAAW,EAAE;AAC9C,MAAI,kBAAkB,YAAY,YAAY,CAC5C,QAAO;WACE,kBAAkB,YAAY,iBAAiB,CACxD,QAAO;WACE,kBAAkB,YAAY,oBAAoB,CAC3D,QAAO;WACE,kBAAkB,YAAY,YAAY,IAAI,kBAAkB,YAAY,WAAW,CAChG,QAAO;EAGT,MAAM,yBAAyB,kCAAkC,WAAW;AAC5E,MAAI,uBACF,QAAO;AAGT,eAAa,KAAK,QAAQ,WAAW;;AAGvC,QAAO"}