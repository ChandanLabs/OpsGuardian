{"version":3,"file":"analytics.mjs","names":["commandParts: string[]"],"sources":["../../src/utils/analytics.ts"],"sourcesContent":["import { add, flush, Identify, identify, init, setOptOut, Types } from '@amplitude/analytics-node'\nimport { getProjectName, getUserIdentifier, isAnalyticsEnabled, trackEvent } from '@motiadev/core'\nimport { version } from '../version'\nimport { MotiaEnrichmentPlugin } from './amplitude/enrichment-plugin'\nimport { BuildError } from './errors/build.error'\n\ninit('ab2408031a38aa5cb85587a27ecfc69c', {\n  logLevel: Types.LogLevel.None,\n})\n\nconst updateOptOutStatus = () => {\n  const optOut = !isAnalyticsEnabled()\n  setOptOut(optOut)\n}\n\nupdateOptOutStatus()\n\nadd(new MotiaEnrichmentPlugin())\n\nexport const enableAnalytics = () => {\n  setOptOut(false)\n}\n\nexport const disableAnalytics = () => {\n  setOptOut(true)\n}\n\nexport const identifyUser = () => {\n  try {\n    const identifyObj = new Identify()\n    identifyObj.postInsert('project_id', getProjectName(process.cwd()))\n    identifyObj.postInsert('motia_version', version || 'unknown')\n    identifyObj.postInsert('project_version', process.env.npm_package_version || 'unknown')\n    identify(identifyObj, {\n      user_id: getUserIdentifier(),\n    })\n  } catch (error) {\n    // Silently fail\n  }\n}\n\nexport const logCliError = (command: string, error: BuildError) => {\n  try {\n    const cause = error.cause instanceof BuildError ? error.cause : (error as Error)\n    const errorMessage = cause?.message || 'Unknown error'\n    const errorType = cause?.constructor?.name || 'Unknown error type'\n    const errorStack = cause?.stack ? cause.stack.split('\\n').slice(0, 10).join('\\n') : undefined\n\n    const truncatedMessage = errorMessage.length > 500 ? `${errorMessage.substring(0, 500)}...` : errorMessage\n\n    trackEvent('cli_command_error', {\n      command,\n      error_message: truncatedMessage,\n      error_type: errorType,\n      ...(errorStack && { error_stack: errorStack }),\n    })\n  } catch (logError) {\n    // Silently fail to not disrupt CLI operations\n  }\n}\n\nconst getCommandNameFromArgs = (): string => {\n  const args = process.argv.slice(2)\n  const commandParts: string[] = []\n\n  for (let i = 0; i < args.length && i < 3; i++) {\n    const arg = args[i]\n    if (!arg.startsWith('-') && !arg.startsWith('--')) {\n      commandParts.push(arg)\n    } else {\n      break\n    }\n  }\n\n  return commandParts.join(' ') || 'unknown'\n}\n\nexport const wrapAction = <T extends (...args: any[]) => Promise<any>>(action: T): T => {\n  return (async (...args: any[]) => {\n    try {\n      return await action(...args)\n    } catch (error) {\n      const commandName = getCommandNameFromArgs()\n      if (error instanceof BuildError) {\n        logCliError(commandName, error as BuildError)\n      }\n      await flush().promise.catch(() => {\n        // Silently fail\n      })\n      throw error\n    }\n  }) as T\n}\n"],"mappings":";;;;;;;AAMA,KAAK,oCAAoC,EACvC,UAAU,MAAM,SAAS,MAC1B,CAAC;AAEF,MAAM,2BAA2B;AAE/B,WADe,CAAC,oBAAoB,CACnB;;AAGnB,oBAAoB;AAEpB,IAAI,IAAI,uBAAuB,CAAC;AAUhC,MAAa,qBAAqB;AAChC,KAAI;EACF,MAAM,cAAc,IAAI,UAAU;AAClC,cAAY,WAAW,cAAc,eAAe,QAAQ,KAAK,CAAC,CAAC;AACnE,cAAY,WAAW,iBAAiB,WAAW,UAAU;AAC7D,cAAY,WAAW,mBAAmB,QAAQ,IAAI,uBAAuB,UAAU;AACvF,WAAS,aAAa,EACpB,SAAS,mBAAmB,EAC7B,CAAC;UACK,OAAO;;AAKlB,MAAa,eAAe,SAAiB,UAAsB;AACjE,KAAI;EACF,MAAM,QAAQ,MAAM,iBAAiB,aAAa,MAAM,QAAS;EACjE,MAAM,eAAe,OAAO,WAAW;EACvC,MAAM,YAAY,OAAO,aAAa,QAAQ;EAC9C,MAAM,aAAa,OAAO,QAAQ,MAAM,MAAM,MAAM,KAAK,CAAC,MAAM,GAAG,GAAG,CAAC,KAAK,KAAK,GAAG;AAIpF,aAAW,qBAAqB;GAC9B;GACA,eAJuB,aAAa,SAAS,MAAM,GAAG,aAAa,UAAU,GAAG,IAAI,CAAC,OAAO;GAK5F,YAAY;GACZ,GAAI,cAAc,EAAE,aAAa,YAAY;GAC9C,CAAC;UACK,UAAU;;AAKrB,MAAM,+BAAuC;CAC3C,MAAM,OAAO,QAAQ,KAAK,MAAM,EAAE;CAClC,MAAMA,eAAyB,EAAE;AAEjC,MAAK,IAAI,IAAI,GAAG,IAAI,KAAK,UAAU,IAAI,GAAG,KAAK;EAC7C,MAAM,MAAM,KAAK;AACjB,MAAI,CAAC,IAAI,WAAW,IAAI,IAAI,CAAC,IAAI,WAAW,KAAK,CAC/C,cAAa,KAAK,IAAI;MAEtB;;AAIJ,QAAO,aAAa,KAAK,IAAI,IAAI;;AAGnC,MAAa,cAA0D,WAAiB;AACtF,SAAQ,OAAO,GAAG,SAAgB;AAChC,MAAI;AACF,UAAO,MAAM,OAAO,GAAG,KAAK;WACrB,OAAO;GACd,MAAM,cAAc,wBAAwB;AAC5C,OAAI,iBAAiB,WACnB,aAAY,aAAa,MAAoB;AAE/C,SAAM,OAAO,CAAC,QAAQ,YAAY,GAEhC;AACF,SAAM"}