import { spawn } from "child_process";

//#region src/utils/ensure-uv.ts
const ensureUvInstalled = async () => {
	if (!await checkCommand("uv", ["--version"])) if (await installUv()) console.log("✅ UV installed successfully via pip");
	else throw new Error("UV could not be installed automatically. Please install manually using one of these methods:\n  • pip install uv (recommended)\n  • pip3 install uv\n  • brew install uv (macOS)\n  • curl -LsSf https://astral.sh/uv/install.sh | sh (if pip is not available)\nFor more information, visit: https://github.com/astral-sh/uv");
};
const checkCommand = async (command, args) => {
	return new Promise((resolve) => {
		const child = spawn(command, args, { stdio: "pipe" });
		child.on("close", (code) => resolve(code === 0));
		child.on("error", () => resolve(false));
	});
};
const installUv = async () => {
	console.log("Installing UV via pip...");
	try {
		if (!await checkCommand("pip", ["--version"])) throw new Error("Pip is not available. Cannot auto-install UV.");
		await runCommand("pip", ["install", "uv"]);
		return await verifyUvInstallation();
	} catch (error) {
		console.error("Failed to install UV via pip:", error);
		return false;
	}
};
async function runCommand(command, args) {
	return new Promise((resolve, reject) => {
		const child = spawn(command, args, { stdio: [
			"pipe",
			"pipe",
			"pipe"
		] });
		let stdout = "";
		let stderr = "";
		child.stdout?.on("data", (data) => {
			stdout += data.toString();
		});
		child.stderr?.on("data", (data) => {
			stderr += data.toString();
		});
		child.on("close", (code) => {
			if (code === 0) resolve(stdout);
			else {
				const errorPrefix = `Command '${command}'`;
				reject(/* @__PURE__ */ new Error(`${errorPrefix} failed: ${stderr || stdout}`));
			}
		});
		child.on("error", (error) => {
			reject(/* @__PURE__ */ new Error(`Failed to spawn ${command}: ${error.message}`));
		});
	});
}
const verifyUvInstallation = async () => {
	await new Promise((resolve) => setTimeout(resolve, 500));
	try {
		await runCommand("uv", ["--version"]);
		return true;
	} catch {
		return false;
	}
};

//#endregion
export { ensureUvInstalled };
//# sourceMappingURL=ensure-uv.mjs.map