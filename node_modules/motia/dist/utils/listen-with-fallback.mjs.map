{"version":3,"file":"listen-with-fallback.mjs","names":[],"sources":["../../src/utils/listen-with-fallback.ts"],"sourcesContent":["import type http from 'http'\nimport net from 'net'\n\nconst MAX_PORT_ATTEMPTS = 10\n\nconst isPortAvailable = (port: number, hostname: string): Promise<boolean> => {\n  return new Promise((resolve) => {\n    const testServer = net.createServer()\n    testServer.once('error', () => resolve(false))\n    testServer.once('listening', () => {\n      testServer.close(() => resolve(true))\n    })\n    testServer.listen(port, hostname)\n  })\n}\n\nconst findAvailablePort = async (startPort: number, hostname: string): Promise<number> => {\n  for (let port = startPort; port < startPort + MAX_PORT_ATTEMPTS; port++) {\n    if (await isPortAvailable(port, hostname)) {\n      return port\n    }\n  }\n  throw new Error(`No available ports found in range ${startPort}-${startPort + MAX_PORT_ATTEMPTS - 1}`)\n}\n\nexport const listenWithFallback = async (server: http.Server, port: number, hostname: string): Promise<number> => {\n  const availablePort = await findAvailablePort(port, hostname)\n\n  return new Promise((resolve, reject) => {\n    server.once('error', (error) => {\n      reject(error)\n    })\n\n    server.listen(availablePort, hostname, () => {\n      resolve(availablePort)\n    })\n  })\n}\n"],"mappings":";;;AAGA,MAAM,oBAAoB;AAE1B,MAAM,mBAAmB,MAAc,aAAuC;AAC5E,QAAO,IAAI,SAAS,YAAY;EAC9B,MAAM,aAAa,IAAI,cAAc;AACrC,aAAW,KAAK,eAAe,QAAQ,MAAM,CAAC;AAC9C,aAAW,KAAK,mBAAmB;AACjC,cAAW,YAAY,QAAQ,KAAK,CAAC;IACrC;AACF,aAAW,OAAO,MAAM,SAAS;GACjC;;AAGJ,MAAM,oBAAoB,OAAO,WAAmB,aAAsC;AACxF,MAAK,IAAI,OAAO,WAAW,OAAO,YAAY,mBAAmB,OAC/D,KAAI,MAAM,gBAAgB,MAAM,SAAS,CACvC,QAAO;AAGX,OAAM,IAAI,MAAM,qCAAqC,UAAU,GAAG,YAAY,oBAAoB,IAAI;;AAGxG,MAAa,qBAAqB,OAAO,QAAqB,MAAc,aAAsC;CAChH,MAAM,gBAAgB,MAAM,kBAAkB,MAAM,SAAS;AAE7D,QAAO,IAAI,SAAS,SAAS,WAAW;AACtC,SAAO,KAAK,UAAU,UAAU;AAC9B,UAAO,MAAM;IACb;AAEF,SAAO,OAAO,eAAe,gBAAgB;AAC3C,WAAQ,cAAc;IACtB;GACF"}