import net from "net";

//#region src/utils/listen-with-fallback.ts
const MAX_PORT_ATTEMPTS = 10;
const isPortAvailable = (port, hostname) => {
	return new Promise((resolve) => {
		const testServer = net.createServer();
		testServer.once("error", () => resolve(false));
		testServer.once("listening", () => {
			testServer.close(() => resolve(true));
		});
		testServer.listen(port, hostname);
	});
};
const findAvailablePort = async (startPort, hostname) => {
	for (let port = startPort; port < startPort + MAX_PORT_ATTEMPTS; port++) if (await isPortAvailable(port, hostname)) return port;
	throw new Error(`No available ports found in range ${startPort}-${startPort + MAX_PORT_ATTEMPTS - 1}`);
};
const listenWithFallback = async (server, port, hostname) => {
	const availablePort = await findAvailablePort(port, hostname);
	return new Promise((resolve, reject) => {
		server.once("error", (error) => {
			reject(error);
		});
		server.listen(availablePort, hostname, () => {
			resolve(availablePort);
		});
	});
};

//#endregion
export { listenWithFallback };
//# sourceMappingURL=listen-with-fallback.mjs.map