{"version":3,"file":"install-plugin-dependencies.mjs","names":["missingDependencies: string[]"],"sources":["../../src/plugins/install-plugin-dependencies.ts"],"sourcesContent":["import fs from 'node:fs'\nimport path from 'node:path'\nimport type { Printer } from '@motiadev/core'\nimport { executeCommand } from '../utils/execute-command'\nimport { getPackageManager } from '../utils/get-package-manager'\nimport { version } from '../version'\nimport { pluginDependencies } from './plugin-dependencies'\n\nexport const installPluginDependencies = async (baseDir: string, printer: Printer): Promise<void> => {\n  const packageJsonPath = path.join(baseDir, 'package.json')\n\n  if (!fs.existsSync(packageJsonPath)) {\n    printer.printPluginWarn('No package.json found, skipping plugin dependency installation')\n    return\n  }\n\n  const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'))\n\n  if (!packageJson.dependencies) {\n    packageJson.dependencies = {}\n  }\n\n  const missingDependencies: string[] = []\n\n  for (const dep of pluginDependencies) {\n    if (packageJson.devDependencies?.[dep]) {\n      delete packageJson.devDependencies[dep]\n    }\n\n    if (!packageJson.dependencies[dep]) {\n      packageJson.dependencies[dep] = version\n      missingDependencies.push(dep)\n    }\n  }\n\n  if (missingDependencies.length === 0) {\n    printer.printPluginLog('All plugin dependencies already installed')\n    return\n  }\n\n  printer.printPluginLog(`Adding missing plugin dependencies: ${missingDependencies.join(', ')}`)\n\n  fs.writeFileSync(packageJsonPath, `${JSON.stringify(packageJson, null, 2)}\\n`)\n  printer.printPluginLog('Updated package.json with plugin dependencies')\n\n  let packageManager = getPackageManager(baseDir)\n  if (packageManager === 'unknown') {\n    printer.printPluginError('No package manager found, using npm as default')\n    packageManager = 'npm'\n  }\n  printer.printPluginLog(`Installing dependencies using ${packageManager}...`)\n\n  const installCommands: Record<string, string> = {\n    npm: 'npm install',\n    yarn: 'yarn install',\n    pnpm: 'pnpm install',\n  }\n\n  const installCommand = installCommands[packageManager] || 'npm install'\n\n  try {\n    await executeCommand(installCommand, baseDir, { silent: false })\n    printer.printPluginLog('Plugin dependencies installed successfully')\n  } catch (error) {\n    printer.printPluginError('Failed to install plugin dependencies:', error)\n    printer.printPluginWarn(`Please run '${installCommand}' manually to install the dependencies`)\n  }\n}\n"],"mappings":";;;;;;;;AAQA,MAAa,4BAA4B,OAAO,SAAiB,YAAoC;CACnG,MAAM,kBAAkB,KAAK,KAAK,SAAS,eAAe;AAE1D,KAAI,CAAC,GAAG,WAAW,gBAAgB,EAAE;AACnC,UAAQ,gBAAgB,iEAAiE;AACzF;;CAGF,MAAM,cAAc,KAAK,MAAM,GAAG,aAAa,iBAAiB,QAAQ,CAAC;AAEzE,KAAI,CAAC,YAAY,aACf,aAAY,eAAe,EAAE;CAG/B,MAAMA,sBAAgC,EAAE;AAExC,MAAK,MAAM,OAAO,oBAAoB;AACpC,MAAI,YAAY,kBAAkB,KAChC,QAAO,YAAY,gBAAgB;AAGrC,MAAI,CAAC,YAAY,aAAa,MAAM;AAClC,eAAY,aAAa,OAAO;AAChC,uBAAoB,KAAK,IAAI;;;AAIjC,KAAI,oBAAoB,WAAW,GAAG;AACpC,UAAQ,eAAe,4CAA4C;AACnE;;AAGF,SAAQ,eAAe,uCAAuC,oBAAoB,KAAK,KAAK,GAAG;AAE/F,IAAG,cAAc,iBAAiB,GAAG,KAAK,UAAU,aAAa,MAAM,EAAE,CAAC,IAAI;AAC9E,SAAQ,eAAe,gDAAgD;CAEvE,IAAI,iBAAiB,kBAAkB,QAAQ;AAC/C,KAAI,mBAAmB,WAAW;AAChC,UAAQ,iBAAiB,iDAAiD;AAC1E,mBAAiB;;AAEnB,SAAQ,eAAe,iCAAiC,eAAe,KAAK;CAQ5E,MAAM,iBAN0C;EAC9C,KAAK;EACL,MAAM;EACN,MAAM;EACP,CAEsC,mBAAmB;AAE1D,KAAI;AACF,QAAM,eAAe,gBAAgB,SAAS,EAAE,QAAQ,OAAO,CAAC;AAChE,UAAQ,eAAe,6CAA6C;UAC7D,OAAO;AACd,UAAQ,iBAAiB,0CAA0C,MAAM;AACzE,UAAQ,gBAAgB,eAAe,eAAe,wCAAwC"}