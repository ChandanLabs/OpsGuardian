{"version":3,"file":"create-plugin-context.mjs","names":["apiConfig: ApiRouteConfig","step: PluginStep<ApiRouteConfig>"],"sources":["../../src/plugins/create-plugin-context.ts"],"sourcesContent":["import type {\n  ApiResponse,\n  ApiRouteConfig,\n  ApiRouteHandler,\n  MotiaPluginContext,\n  MotiaServer,\n  PluginApiConfig,\n  PluginStep,\n  UnregisterMotiaPluginApi,\n} from '@motiadev/core'\n\nexport const createPluginContext = (motiaServer: MotiaServer): MotiaPluginContext => {\n  const { motia, addRoute, removeRoute, printer } = motiaServer\n  return {\n    printer,\n    tracerFactory: motia.tracerFactory,\n    state: motia.stateAdapter,\n    lockedData: motia.lockedData,\n    eventAdapter: motia.eventAdapter,\n    registerApi: <\n      TRequestBody = unknown,\n      TResponseBody extends ApiResponse<number, unknown> = ApiResponse<number, unknown>,\n      TEmitData = never,\n    >(\n      config: PluginApiConfig,\n      handler: ApiRouteHandler<TRequestBody, TResponseBody, TEmitData>,\n    ): UnregisterMotiaPluginApi => {\n      const apiConfig: ApiRouteConfig = {\n        type: 'api',\n        name: `Plugin API: ${config.method} ${config.path}`,\n        path: config.path,\n        method: config.method,\n        emits: [],\n        flows: ['_plugin'],\n      }\n\n      const step: PluginStep<ApiRouteConfig> = {\n        filePath: `__plugin_${Date.now()}_${config.method}_${config.path.replace(/\\//g, '_')}.ts`,\n        version: '1',\n        config: apiConfig,\n        handler,\n      }\n      addRoute(step)\n      return () => {\n        removeRoute(step)\n      }\n    },\n  }\n}\n"],"mappings":";AAWA,MAAa,uBAAuB,gBAAiD;CACnF,MAAM,EAAE,OAAO,UAAU,aAAa,YAAY;AAClD,QAAO;EACL;EACA,eAAe,MAAM;EACrB,OAAO,MAAM;EACb,YAAY,MAAM;EAClB,cAAc,MAAM;EACpB,cAKE,QACA,YAC6B;GAC7B,MAAMA,YAA4B;IAChC,MAAM;IACN,MAAM,eAAe,OAAO,OAAO,GAAG,OAAO;IAC7C,MAAM,OAAO;IACb,QAAQ,OAAO;IACf,OAAO,EAAE;IACT,OAAO,CAAC,UAAU;IACnB;GAED,MAAMC,OAAmC;IACvC,UAAU,YAAY,KAAK,KAAK,CAAC,GAAG,OAAO,OAAO,GAAG,OAAO,KAAK,QAAQ,OAAO,IAAI,CAAC;IACrF,SAAS;IACT,QAAQ;IACR;IACD;AACD,YAAS,KAAK;AACd,gBAAa;AACX,gBAAY,KAAK;;;EAGtB"}