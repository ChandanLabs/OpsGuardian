{"version":3,"file":"setup.mjs","names":["path","fs","readline"],"sources":["../../src/docker/setup.ts"],"sourcesContent":["import { getProjectIdentifier, trackEvent } from '@motiadev/core'\nimport * as fs from 'fs'\nimport * as path from 'path'\nimport * as readline from 'readline'\nimport { fileURLToPath } from 'url'\nimport { identifyUser } from '../utils/analytics'\nimport { printMotiaDockerIntro } from './utils/print-intro'\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url))\n\nconst resolveTemplatesDir = (): string => {\n  const localTemplates = path.join(__dirname, './templates')\n  if (fs.existsSync(localTemplates)) {\n    return localTemplates\n  }\n  // Fallback for development: resolve to packages/docker/templates\n  return path.join(__dirname, '../../../docker/templates')\n}\n\nconst templatesDir = resolveTemplatesDir()\n\nconst updatePackageJson = (): void => {\n  const packageJsonPath = path.join(process.cwd(), 'package.json')\n  if (fs.existsSync(packageJsonPath)) {\n    const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'))\n    if (!packageJson.scripts) {\n      packageJson.scripts = {}\n    }\n    packageJson.scripts.start = 'motia start'\n    fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson, null, 2))\n    console.log('Updated package.json with start script')\n  }\n}\n\nconst createDockerfile = async () => {\n  const dockerfilePath = path.join(process.cwd(), 'Dockerfile')\n\n  if (fs.existsSync(dockerfilePath)) {\n    console.log('Dockerfile already exists')\n\n    const rl = readline.createInterface({\n      input: process.stdin,\n      output: process.stdout,\n    })\n\n    const shouldOverride = await new Promise<boolean>((resolve) => {\n      rl.question('Do you want to override the existing Dockerfile? (y/N): ', (answer) => {\n        rl.close()\n        resolve(answer.toLowerCase() === 'y' || answer.toLowerCase() === 'yes')\n      })\n    })\n\n    if (!shouldOverride) {\n      console.log('Dockerfile generation cancelled')\n      return\n    }\n  }\n\n  const dockerfileContent = fs.readFileSync(path.join(templatesDir, 'MotiaDockerSample'), 'utf-8')\n\n  try {\n    fs.writeFileSync(dockerfilePath, dockerfileContent)\n    console.log('Dockerfile generated successfully!')\n  } catch (error) {\n    console.error('Error generating Dockerfile:', (error as Error).message)\n    throw error\n  }\n}\n\nconst createDockerignore = async () => {\n  identifyUser()\n\n  trackEvent('docker_setup_command', {\n    project_name: getProjectIdentifier(process.cwd()),\n  })\n\n  const dockerignoreContent = fs.readFileSync(path.join(templatesDir, '.dockerignore.sample'), 'utf-8')\n\n  const dockerignorePath = path.join(process.cwd(), '.dockerignore')\n\n  if (fs.existsSync(dockerignorePath)) {\n    console.log('.dockerignore already exists')\n    const rl = readline.createInterface({\n      input: process.stdin,\n      output: process.stdout,\n    })\n\n    const shouldOverride = await new Promise<boolean>((resolve) => {\n      rl.question('Do you want to override the existing .dockerignore? (y/N): ', (answer) => {\n        rl.close()\n        resolve(answer.toLowerCase() === 'y' || answer.toLowerCase() === 'yes')\n      })\n    })\n\n    if (!shouldOverride) {\n      console.log('.dockerignore generation cancelled')\n      return\n    }\n  }\n\n  try {\n    fs.writeFileSync(dockerignorePath, dockerignoreContent)\n    console.log('.dockerignore generated successfully!')\n  } catch (error) {\n    console.error('Error generating .dockerignore:', (error as Error).message)\n    throw error\n  }\n}\n\nexport const setup = async (): Promise<void> => {\n  printMotiaDockerIntro()\n\n  await createDockerfile()\n  await createDockerignore()\n  updatePackageJson()\n}\n"],"mappings":";;;;;;;;;AAQA,MAAM,YAAYA,OAAK,QAAQ,cAAc,OAAO,KAAK,IAAI,CAAC;AAE9D,MAAM,4BAAoC;CACxC,MAAM,iBAAiBA,OAAK,KAAK,WAAW,cAAc;AAC1D,KAAIC,KAAG,WAAW,eAAe,CAC/B,QAAO;AAGT,QAAOD,OAAK,KAAK,WAAW,4BAA4B;;AAG1D,MAAM,eAAe,qBAAqB;AAE1C,MAAM,0BAAgC;CACpC,MAAM,kBAAkBA,OAAK,KAAK,QAAQ,KAAK,EAAE,eAAe;AAChE,KAAIC,KAAG,WAAW,gBAAgB,EAAE;EAClC,MAAM,cAAc,KAAK,MAAMA,KAAG,aAAa,iBAAiB,QAAQ,CAAC;AACzE,MAAI,CAAC,YAAY,QACf,aAAY,UAAU,EAAE;AAE1B,cAAY,QAAQ,QAAQ;AAC5B,OAAG,cAAc,iBAAiB,KAAK,UAAU,aAAa,MAAM,EAAE,CAAC;AACvE,UAAQ,IAAI,yCAAyC;;;AAIzD,MAAM,mBAAmB,YAAY;CACnC,MAAM,iBAAiBD,OAAK,KAAK,QAAQ,KAAK,EAAE,aAAa;AAE7D,KAAIC,KAAG,WAAW,eAAe,EAAE;AACjC,UAAQ,IAAI,4BAA4B;EAExC,MAAM,KAAKC,WAAS,gBAAgB;GAClC,OAAO,QAAQ;GACf,QAAQ,QAAQ;GACjB,CAAC;AASF,MAAI,CAPmB,MAAM,IAAI,SAAkB,YAAY;AAC7D,MAAG,SAAS,6DAA6D,WAAW;AAClF,OAAG,OAAO;AACV,YAAQ,OAAO,aAAa,KAAK,OAAO,OAAO,aAAa,KAAK,MAAM;KACvE;IACF,EAEmB;AACnB,WAAQ,IAAI,kCAAkC;AAC9C;;;CAIJ,MAAM,oBAAoBD,KAAG,aAAaD,OAAK,KAAK,cAAc,oBAAoB,EAAE,QAAQ;AAEhG,KAAI;AACF,OAAG,cAAc,gBAAgB,kBAAkB;AACnD,UAAQ,IAAI,qCAAqC;UAC1C,OAAO;AACd,UAAQ,MAAM,gCAAiC,MAAgB,QAAQ;AACvE,QAAM;;;AAIV,MAAM,qBAAqB,YAAY;AACrC,eAAc;AAEd,YAAW,wBAAwB,EACjC,cAAc,qBAAqB,QAAQ,KAAK,CAAC,EAClD,CAAC;CAEF,MAAM,sBAAsBC,KAAG,aAAaD,OAAK,KAAK,cAAc,uBAAuB,EAAE,QAAQ;CAErG,MAAM,mBAAmBA,OAAK,KAAK,QAAQ,KAAK,EAAE,gBAAgB;AAElE,KAAIC,KAAG,WAAW,iBAAiB,EAAE;AACnC,UAAQ,IAAI,+BAA+B;EAC3C,MAAM,KAAKC,WAAS,gBAAgB;GAClC,OAAO,QAAQ;GACf,QAAQ,QAAQ;GACjB,CAAC;AASF,MAAI,CAPmB,MAAM,IAAI,SAAkB,YAAY;AAC7D,MAAG,SAAS,gEAAgE,WAAW;AACrF,OAAG,OAAO;AACV,YAAQ,OAAO,aAAa,KAAK,OAAO,OAAO,aAAa,KAAK,MAAM;KACvE;IACF,EAEmB;AACnB,WAAQ,IAAI,qCAAqC;AACjD;;;AAIJ,KAAI;AACF,OAAG,cAAc,kBAAkB,oBAAoB;AACvD,UAAQ,IAAI,wCAAwC;UAC7C,OAAO;AACd,UAAQ,MAAM,mCAAoC,MAAgB,QAAQ;AAC1E,QAAM;;;AAIV,MAAa,QAAQ,YAA2B;AAC9C,wBAAuB;AAEvB,OAAM,kBAAkB;AACxB,OAAM,oBAAoB;AAC1B,oBAAmB"}