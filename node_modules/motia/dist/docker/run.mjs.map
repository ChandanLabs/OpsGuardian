{"version":3,"file":"run.mjs","names":["path","fs"],"sources":["../../src/docker/run.ts"],"sourcesContent":["import { getProjectIdentifier, trackEvent } from '@motiadev/core'\nimport * as fs from 'fs'\nimport * as path from 'path'\nimport { identifyUser } from '../utils/analytics'\nimport { buildDockerImage } from './utils/build-docker-image'\nimport { printMotiaDockerIntro } from './utils/print-intro'\nimport { promiseExec } from './utils/promised-exec'\n\nexport const run = async (hostPort = 3000, projectName?: string, skipBuild?: boolean): Promise<void> => {\n  printMotiaDockerIntro()\n\n  identifyUser()\n\n  let nextProjectName = projectName\n  if (!projectName) {\n    const packageJsonPath = path.join(process.cwd(), 'package.json')\n    const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'))\n    nextProjectName = packageJson.name\n  }\n\n  trackEvent('docker_run_command', {\n    dockerImageName: nextProjectName,\n    project_name: getProjectIdentifier(process.cwd()),\n  })\n\n  console.log(`Preparing your docker container for project: ${nextProjectName}`)\n\n  const dockerfileContent = fs.readFileSync(path.join(process.cwd(), 'Dockerfile'), 'utf-8')\n  const dockerPort = dockerfileContent.match(/EXPOSE\\s+(\\d+)/)?.[1] || '3000'\n\n  if (!fs.existsSync(path.join(process.cwd(), 'Dockerfile'))) {\n    console.error('Dockerfile not found')\n    process.exit(1)\n  }\n\n  let dockerImageName = nextProjectName\n  const dockerRunCommand = `docker run -it --rm -p ${hostPort}:${dockerPort} ${dockerImageName}`\n\n  if (!skipBuild) {\n    dockerImageName = await buildDockerImage(dockerImageName)\n  } else {\n    // check if the image exists\n    try {\n      await promiseExec(`docker image inspect ${dockerImageName}`, false)\n      console.log(`Docker image ${dockerImageName} found`)\n    } catch (error) {\n      console.error(`Docker image ${dockerImageName} not found, remove the skip flag to build it`)\n      process.exit(1)\n    }\n  }\n\n  console.log(`Running docker container: ${dockerImageName}`)\n  await promiseExec(dockerRunCommand)\n}\n"],"mappings":";;;;;;;;;AAQA,MAAa,MAAM,OAAO,WAAW,KAAM,aAAsB,cAAuC;AACtG,wBAAuB;AAEvB,eAAc;CAEd,IAAI,kBAAkB;AACtB,KAAI,CAAC,aAAa;EAChB,MAAM,kBAAkBA,OAAK,KAAK,QAAQ,KAAK,EAAE,eAAe;AAEhE,oBADoB,KAAK,MAAMC,KAAG,aAAa,iBAAiB,QAAQ,CAAC,CAC3C;;AAGhC,YAAW,sBAAsB;EAC/B,iBAAiB;EACjB,cAAc,qBAAqB,QAAQ,KAAK,CAAC;EAClD,CAAC;AAEF,SAAQ,IAAI,gDAAgD,kBAAkB;CAG9E,MAAM,aADoBA,KAAG,aAAaD,OAAK,KAAK,QAAQ,KAAK,EAAE,aAAa,EAAE,QAAQ,CACrD,MAAM,iBAAiB,GAAG,MAAM;AAErE,KAAI,CAACC,KAAG,WAAWD,OAAK,KAAK,QAAQ,KAAK,EAAE,aAAa,CAAC,EAAE;AAC1D,UAAQ,MAAM,uBAAuB;AACrC,UAAQ,KAAK,EAAE;;CAGjB,IAAI,kBAAkB;CACtB,MAAM,mBAAmB,0BAA0B,SAAS,GAAG,WAAW,GAAG;AAE7E,KAAI,CAAC,UACH,mBAAkB,MAAM,iBAAiB,gBAAgB;KAGzD,KAAI;AACF,QAAM,YAAY,wBAAwB,mBAAmB,MAAM;AACnE,UAAQ,IAAI,gBAAgB,gBAAgB,QAAQ;UAC7C,OAAO;AACd,UAAQ,MAAM,gBAAgB,gBAAgB,8CAA8C;AAC5F,UAAQ,KAAK,EAAE;;AAInB,SAAQ,IAAI,6BAA6B,kBAAkB;AAC3D,OAAM,YAAY,iBAAiB"}